<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>NPL Block Information Station</title>
	<link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
	<?!= include('css')?>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/b-1.6.2/b-colvis-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/sl-1.3.1/datatables.min.css"/>
	<script type="text/javascript"
		src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/b-1.6.2/b-colvis-1.6.2/b-html5-1.6.2/b-print-1.6.2/cr-1.5.2/fc-3.3.1/sl-1.3.1/datatables.min.js">
	</script>
	<script>
		// color constants (in HEX)
      const red = '#800000'
      const blue = '#0080ff'
      const greenish = '#00ffbf'
      const purple = '#aa00ff'
      const magenta = '#ff00ff'
      const orange = '#e66000'
      const green = '#008000'
      const black = '#000000'
      const grey = '#ababab'
      // color for each test (notStarted, 5A-grade, 5B-grade, 5C-Grade, fail)
      const testColors = [grey, green, orange, blue, red]
      // color for each test
      const checkColors = {false: grey, true: green}
      // larger grade values are worse
      const aGrade = 1
      const bGrade = 2
      const cGrade = 3
      const fGrade = 4
      const notStartedGrade = 0
      // GRADING FUNCTIONS
      function grade_pregrade (grade) {
        if (grade === '5a') {
          return aGrade
        } else if (grade === '5b') {
          return bGrade
        } else if (grade === '5c') {
          return cGrade
        } else if (grade === '8') {
          return fGrade
        } else {
          return null
        }
      }
      function grade_density (density) {
        if (density > 8.8) {
          return aGrade
        } else if (density >= 8.7) {
          return bGrade
        } else if (density >= 8.4) {
          return cGrade
        } else {
          return fGrade
        }
      }
      function grade_dL (dL) {
        if (Math.abs(dL) <= 0.03) {
          return aGrade
        } else if (dL <= 0.05 && dL >= -0.1) {
          return bGrade
        } else {
          return fGrade
        }
      }
      function grade_otherDev (dev) {
        if (Math.abs(dev) <= 0.02) {
          return aGrade
        } else if (dev <= 0.02 && dev >= -0.04) {
          return bGrade
        } else {
          return fGrade
        }
      }
      function grade_missingRow (x) {
        if (x) {
          return fGrade
        } else {
          return aGrade
        }
      }
      function grade_thirteenHoles (x) {
        if (x) {
          return fGrade
        } else {
          return aGrade
        }
      }
      function grade_fiberPercentage (percent) {
        if (percent >= 98) {
          return aGrade
        } else if (percent >= 97) {
          return bGrade
        } else if (percent >= 96) {
          return cGrade
        } else {
          return fGrade
        }
      }
      function grade_tower (percent) {
        if (percent >= 96) {
          return aGrade
        } else if (percent >= 94) {
          return bGrade
        } else if (percent >= 92) {
          return cGrade
        } else {
          return fGrade
        }
      }
      function grade_scintRatio (ratio) {
        if (ratio >= 0.7) {
          return aGrade
        } else {
          return fGrade
        }
      }
      
      class Block {
        constructor(array, sheet, numericDBN) {
          this.sheet = sheet
          this.numericDBN = numericDBN
          this.dbn = array[0]
          this.block = parseInt(array[2])
          this.status = array[3]
          this.shipment = (!dataPresent(array[4])) ? null : parseInt(array[4])
          this.shipmentDate = (!dataPresent(array[5])) ? null : usDateToYYYYMMDD(array[5], this.sheet, this.dbn, "shipment date")
          this.comment = (!dataPresent(array[6])) ? null : array[6]
          this.sector = (!dataPresent(array[7])) ? null : array[7]
          this.powder = (!dataPresent(array[14])) ? null : array[14]
          this.bucket = (!dataPresent(array[15])) ? null : array[15]
          this.moldSeries = (!dataPresent(array[16])) ? null : array[16]
          this.emptyMoldMass = (!dataPresent(array[17])) ? null : parseInt(array[17])
          this.filledMoldMass = (!dataPresent(array[18])) ? null : parseInt(array[18])
          this.tungstenMass = (!dataPresent(array[19]) || parseInt(array[19]) === 0) ? null : parseInt(array[19])
          this.tungstenFillingDate = (!dataPresent(array[21])) ? null : usDateToYYYYMMDD(array[21], this.sheet, this.dbn, "tungsten filling date")
          this.tungstenFiller = (!dataPresent(array[22])) ? null : array[22]
          this.epoxyBatch = (!dataPresent(array[23])) ? null : parseInt(array[23])
          this.resinMass = (!dataPresent(array[24])) ? null : parseInt(array[24])
          this.hardenerMass = (!dataPresent(array[25])) ? null : parseInt(array[25])
          this.pottingNotes = (!dataPresent(array[26])) ? null : array[26]
          this.epoxyFillingTime = (!dataPresent(array[27])) ? null : parseFloat(array[27])
          this.epoxyFillingDate = (!dataPresent(array[28])) ? null : usDateToYYYYMMDD(array[28], this.sheet, this.dbn, "epoxy filling date")
          this.epoxyPreparer = (!dataPresent(array[29])) ? null : array[29]
          this.machiningDate = (!dataPresent(array[31])) ? null : usDateToYYYYMMDD(array[31], this.sheet, this.dbn, "machining date")
          this.l = (!dataPresent(array[33])) ? null : parseFloat(array[33])
          this.bt = (!dataPresent(array[34])) ? null : parseFloat(array[34])
          this.bb = (!dataPresent(array[35])) ? null : parseFloat(array[35])
          this.bh = (!dataPresent(array[36])) ? null : parseFloat(array[36])
          this.st = (!dataPresent(array[37])) ? null : parseFloat(array[37])
          this.sb = (!dataPresent(array[38])) ? null : parseFloat(array[38])
          this.sh = (!dataPresent(array[39])) ? null : parseFloat(array[39])
          this.volume = (!dataPresent(array[40]) || parseInt(array[40]) === 0) ? null : parseFloat(array[40])
          this.dimensionTester = (!dataPresent(array[41])) ? null : array[41]
          this.mass = (!dataPresent(array[42])) ? null : parseInt(array[42])
          this.massTester = (!dataPresent(array[43])) ? null : array[43]
          this.density = (!dataPresent(array[44])) ? null : parseFloat(array[44])
          this.densityDate = (!dataPresent(array[45])) ? null : parseInt(array[45])
          this.goodEnd = (!dataPresent(array[47])) ? null : array[47]
          this.fiberPercentage = (!dataPresent(array[49]) || parseInt(array[49]) === 0) ? null : parseFloat(array[49])
          this.tower1 = (!dataPresent(array[55])) ? null : parseFloat(array[55])
          this.tower2 = (!dataPresent(array[56])) ? null : parseFloat(array[56])
          this.tower3 = (!dataPresent(array[57])) ? null : parseFloat(array[57])
          this.tower4 = (!dataPresent(array[58])) ? null : parseFloat(array[58])
          this.missingRow = (!dataPresent(array[59])) ? null : ((array[59] === 'Y') ? true : (array[59] === 'N') ? false : null)
          this.thirteenHoles = (!dataPresent(array[60])) ? null : ((array[60] === 'Y') ? true : (array[60] === 'N') ? false : null)
          this.lightTransTester = (!dataPresent(array[63])) ? null : array[63]
          this.lightTransDate = (!dataPresent(array[64])) ? null : array[64]
          this.lightTransDateActual = (!dataPresent(array[64]) || isNaN(parseInt(removeSuffix(array[64])))) ? null : parseInt(removeSuffix(array[64]))
          this.scintillation = (!dataPresent(array[65])) ? null : parseFloat(array[65])
          this.scintRatio = (!dataPresent(array[67])) ? null : parseFloat(array[67])
          this.scintTester = (!dataPresent(array[68])) ? null : array[68]
          this.scintDate = (!dataPresent(array[69])) ? null : array[69]
          this.scintDateActual = (!dataPresent(array[69]) || isNaN(parseInt(removeSuffix(array[69])))) ? null : parseInt(removeSuffix(array[69]))
          this.natLightDate = (!dataPresent(array[70])) ? null : parseInt(array[70])
          this.natLightTester = (!dataPresent(array[71])) ? null : array[71]
          this.retouch = array[72]
          this.densityCheckedBy = dataPresent(array[73]) ? array[73] : null
          this.densityChecked = this.densityCheckedBy != null
          this.lightTransCheckedBy = dataPresent(array[74]) ? array[74] : null
          this.lightTransChecked = this.lightTransCheckedBy != null
          this.natLightCheckedBy = dataPresent(array[75]) ? array[75] : null
          this.natLightChecked = this.natLightCheckedBy != null
          this.pregrade = array[80]
          //other calculations
          let densityCompleteVars = [this.volume, this.mass, this.massTester, this.l, this.bt, this.bb, this.bh, this.st, this.sb, this.sh]
          this.densityComplete = (densityCompleteVars.every((value) => value != null)) ? true : false
          this.lightTransComplete = (this.fiberPercentage != null && this.missingRow != null && this.thirteenHoles != null && this.lightTransTester != null) ? true : false
          this.scintComplete = (this.scintillation != null && this.scintRatio != null) ? true : false
          this.natLightComplete = (this.natLightDate != null && this.natLightTester != null) ? true : false
          this.testsComplete = this.densityComplete && this.lightTransComplete && this.scintComplete && this.natLightComplete
          this.testsChecked = this.densityChecked && this.lightTransChecked && this.natLightChecked
        }
        getTungstenData() {return [this.powder, this.bucket, this.moldSeries, this.emptyMoldMass, this.filledMoldMass, this.tungstenMass,this.tungstenFiller, this.tungstenFillingDate]}
        getEpoxyData() {return [this.epoxyBatch, this.resinMass, this.hardenerMass, this.pottingNotes, this.epoxyFillingTime, this.epoxyFillingDate, this.epoxyPreparer]}
        hasDensityData() {return [this.l, this.bt, this.bb, this.bh, this.st, this.sb, this.sh, this.volume, this.dimensionTester, this.mass, this.massTester, this.density, this.densityDate].some((value) => value != null)}
        hasLightTransData() {return [this.goodEnd, this.fiberPercentage, this.tower1, this.tower2, this.tower3, this.tower4, this.missingRow, this.thirteenHoles, this.lightTransTester, this.lightTransDate].some((value) => value != null)}
        hasTowerData() {return [this.tower1, this.tower2, this.tower3, this.tower4].some((value) => value != null)}
        hasNatLightData() {return [this.natLightDate, this.natLightTester].some((value) => value != null)}
        hasScintData() {return [this.scintillation, this.scintRatio, this.scintDate].some((value) => value != null)}
        deviations() {
          let dbn = this.dbn
          let block = this.block
          let tols = [this.l, this.bt, this.bb, this.bh, this.st, this.sb, this.sh]
          let devs = []
          if (dimensionsMap.has(block)) {
            tols.forEach(function(value, index) {
              if (value != null) {
                devs[index] = value - dimensionsMap.get(block)[index]
              } else {
                  devs[index] = null
              }
            })
          } else {
            devs = null
            console.log("dimensionsMap did not have key for block '" + block + "' at DBN '" + dbn + "'")
          }
          return devs
        }
        testGrades() {
            let devs = this.deviations()
            let devGrades = new Array(7)
            if (devs == null) {
              devGrades.fill(notStartedGrade)
            } else {
              for (let i = 0; i < devs.length; i++) {
                if (i === 0) {
                  devGrades[0] = (devs[0] == null) ? notStartedGrade : grade_dL(devs[0])
                } else {
                  devGrades[i] = (devs[i] == null) ? notStartedGrade : grade_otherDev(devs[i])
                }
              }
            }
            let densityValuesToGrade = [
              ((this.density == null) ? notStartedGrade : grade_density(this.density)),
              ...devGrades
            ]
            let densityGrade
            if (densityValuesToGrade.some((value) => value == notStartedGrade))
            {
              densityGrade = 0
            } else {
              densityGrade = Math.max(...densityValuesToGrade)
            }
            let towers = [this.tower1, this.tower2, this.tower3, this.tower4]
            let towerGrades = new Array(4)
            if (towers.every((value) => value != null)) {
              for (let i = 0; i < towers.length; i++) {
                towerGrades[i] = (towers[i] == null) ? notStartedGrade : grade_tower(towers[i])
              }
            } else {
              towerGrades.fill(notStartedGrade)
            }
            let lightTransValuesToGrade = [
              (this.fiberPercentage == null) ? notStartedGrade : grade_fiberPercentage(this.fiberPercentage),
              ...towerGrades,
              (this.missingRow == null) ? notStartedGrade : (this.missingRow) ? fGrade : aGrade,
              (this.thirteenHoles == null) ? notStartedGrade : (this.thirteenHoles) ? fGrade : aGrade
            ]
            let lightTransGrade = Math.max(...lightTransValuesToGrade)
            let scintGrade = (this.scintRatio == null) ? notStartedGrade : grade_scintRatio(this.scintRatio)
            let natLightGrade = (this.natLightDate != null || this.natLightTester != null) ? aGrade : notStartedGrade
            return {
              density: densityGrade,
              tolerances: devGrades,
              lightTrans: lightTransGrade,
              towers: towerGrades,
              scint: scintGrade,
              natLight: natLightGrade
            }
          }
        getUrls(imageUrlsCallback, histogramUrlsCallback) {
          let that = this
          if (!this.gotUrls) {
            let toGetImageUrls = [this.numericDBN.toString(),
              (this.lightTransDate == null) ? null : this.lightTransDate.toString(),
              (this.natLightDate == null) ? null : this.natLightDate.toString()
            ]
            if (this.lightTransDate != null || this.natLightDate != null) {
              google.script.run.withSuccessHandler(imageUrlsCallback).getImageUrls(toGetImageUrls)
            } else {
              imageUrlsCallback(null)
            }
            if (this.lightTransDate != null) {
              google.script.run.withSuccessHandler(histogramUrlsCallback).getHistograms(toGetImageUrls)
            } else {
              histogramUrlsCallback(null)
            }
          }
        }
      }
      class BlocksCollection {
        constructor(array) {
          this.array = array
        }
        getBlockByNumericDBN (dbn) {
          return this.array[dbn]
        }
        getBlockByStringDBN (stringDBN) {
          let numDBN
          this.array.forEach (function (block, index, array) {
            if (stringDBN === block.dbn) {
              numDBN = index
            }
          })
          if (numDBN != null) {return this.array[numDBN]}
        }
        getBlocksNeedingRetouch (retouchStatus) {
          let blocks = []
          let devNames = ['L', 'BT', 'BB', 'BH', 'ST', 'SB', 'SH']
          let allowedStatuses = ['5', '5a', '5b', '5c']
          this.array.forEach(function (block) {
            if (block.deviations() != null && block.retouch === retouchStatus && allowedStatuses.includes(block.status)) {
              let retouchDevs = []
              block.deviations().forEach(function(dev, index) {
                if (index === 0) {
                  if (grade_dL(dev) === fGrade && dev > 0) {
                    retouchDevs.push([devNames[index], '+' + dev.toFixed(4)])
                  }
                } else if (grade_otherDev(dev) === fGrade && dev > 0) { 
                  retouchDevs.push([devNames[index], '+' + dev.toFixed(4)])
                }
              })
              if (retouchDevs.length > 0) {
                blocks.push([block, retouchDevs])
              }
            }
          })
          return blocks
        }
        getBlocksModifiedInDateRange(fromDate, toDate) {
          let noMin = false
          let noMax = false
          if (fromDate == null) {noMin = true}
          if (toDate == null) {noMax = true}
          let dates
          if (!noMin && !noMax) {
            dates = []
            let current = fromDate
            while (current <= toDate) {
              dates.push(current)
              let date = YYYYMMDDtoDate(current)
              date.setDate(date.getDate() + 1)
              current = dateToYYYYMMDD(date)
            }
            //console.log('date range: ' + dates)
          }
          let tungstenFilled = []
          let epoxyFilled = []
          let machined = []
          let densityTested = []
          let lightTransTested = []
          let scintTested = []
          let natLightTested = []
          this.array.forEach(function(block) {
            let date = block.tungstenFillingDate
            if (date != null) {
              if ((noMin && noMax && block.tungstenFillingDate != null)
                || (noMin && block.tungstenFillingDate <= toDate)
                || (noMax && block.tungstenFillingDate >= fromDate)
                || (dates != null && dates.includes(block.tungstenFillingDate)))
              {tungstenFilled.push(block)}
            }
          })
          this.array.forEach(function(block) {
            let date = block.epoxyFillingDate
            if (date != null) {
              if ((noMin && noMax && block.epoxyFillingDate != null)
                || (noMin && block.epoxyFillingDate <= toDate)
                || (noMax && block.epoxyFillingDate >= fromDate)
                || (dates != null && dates.includes(block.epoxyFillingDate)))
              {epoxyFilled.push(block)}
            }
          })
          this.array.forEach(function(block) {
            let date = block.machiningDate
            if (date != null) {
              if ((noMin && noMax && block.machiningDate != null)
                || (noMin && block.machiningDate <= toDate)
                || (noMax && block.machiningDate >= fromDate)
                || (dates != null && dates.includes(block.machiningDate)))
              {machined.push(block)}
            }
          })
          this.array.forEach(function(block) {
            let date = block.densityDate
            if (date != null) {
              if ((noMin && noMax && block.densityDate != null)
                || (noMin && block.densityDate <= toDate)
                || (noMax && block.densityDate >= fromDate)
                || (dates != null && dates.includes(block.densityDate)))
              {densityTested.push(block)}
            }
          })
          this.array.forEach(function(block) {
            let date = block.lightTransDateActual
            if (date != null) {
              if ((noMin && noMax && block.lightTransDateActual != null)
                || (noMin && block.lightTransDateActual <= toDate)
                || (noMax && block.lightTransDateActual >= fromDate)
                || (dates != null && dates.includes(block.lightTransDateActual)))
              {lightTransTested.push(block)}
            }
          })
          this.array.forEach(function(block) {
            let date = block.scintDateActual
            if (date != null) {
              if ((noMin && noMax && block.scintDateActual != null)
                || (noMin && block.scintDateActual <= toDate)
                || (noMax && block.scintDateActual >= fromDate)
                || (dates != null && dates.includes(block.scintDateActual)))
              {scintTested.push(block)}
            }
          })
          this.array.forEach(function(block) {
            let date = block.natLightDate
            if (date != null) {
              if ((noMin && noMax && block.natLightDate != null)
                || (noMin && block.natLightDate <= toDate)
                || (noMax && block.natLightDate >= fromDate)
                || (dates != null && dates.includes(block.natLightDate)))
              {natLightTested.push(block)}
            }
          })
          return {
            tungstenFilled: tungstenFilled,
            epoxyFilled: epoxyFilled,
            machined: machined,
            densityTested: densityTested,
            lightTransTested: lightTransTested,
            scintTested: scintTested,
            natLightTested: natLightTested
          }
        }
      }
	</script>
	<script>
		// configuration for the blocks table
      const blocksTableOptions = {
        paging: false,
        scrollX: true,
        scrollY: "480px",
        dom: 'Brtp',
        buttons: [
          {extend: 'colvis', text:'Columns', collectionLayout: 'fixed four-column'},
          {extend: 'collection', text: 'Tests', buttons: [
            {extend: 'columnToggle', text: 'Block Information', columns: '.basicInfo'},
            {extend: 'columnToggle', text: 'Graded', columns: '.hasGrade'},
            {extend: 'columnToggle', text: 'Tungsten', columns: '.tungsten'},
            {extend: 'columnToggle', text: 'Epoxy', columns: '.epoxy'},
            {extend: 'columnToggle', text: 'Density', columns: '.density'},
            {extend: 'columnToggle', text: 'Tolerances', columns: '.tolerances'},
            {extend: 'columnToggle', text: 'Light Transmission', columns: '.lightTrans'},
            {extend: 'columnToggle', text: 'Towers', columns: '.towers'},
            {extend: 'columnToggle', text: 'Scintillation', columns: '.scint'},
            {extend: 'columnToggle', text: 'Natural Light', columns: '.natLight'}]
          },
          {extend: 'copy', exportOptions: {columns: ':visible'}}
        ],
        colReorder: true,
        colReorder: {fixedColumnsLeft: 1},
        fixedColumns: true,
        select: false,
        columns: [
        {name: "dbn", "title": "DBN", className: "dt-center basicInfo bolded searchExact", "searchable": true, "type": "numericEmptyUnsorted", "visible": true, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              return '<span style="font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>';
            }
          } else {
            return data
          }
        }},
        {name: "block", "title": "Block", className: "dt-center basicInfo searchExact", "searchable": true, "type": "block", "visible": true},
        {name: "comment", "title": "Comment", className: "dt-center search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "status", "title": "Status", className: "dt-center basicInfo searchExact", "searchable": true, "type": "status", "visible": true},
        {name: "testingStatus", title: "Testing Status", className: "dt-center basicInfo hasGrade", "searchable": false, "type": "testingStatus","visible": true, render: function ( data, type, row ) {
          if (!dataPresent(data)) {
            return ''
          } else if (type === 'display') {
            let tests = ['D', 'LT', 'S', 'NL']
            function createSpan(text, color, style) {
              if (style === 'bolded') {
                return '<span style="color: ' + color + '; font-weight: bold;">' + text + '</span>'
              } else if (style === 'normal') {
                return '<span style="color: ' + color + ';">' + text + '</span>'
              } else if (style === 'italicizedDotted') {
                return '<span style="color: ' + color + '; font-style: italic; border-bottom: 2px dotted ' + color + ';">' + text + '</span>'
              } else {
                return '<span style="color: ' + color + '; font-weight: bold">' + text + '</span>'
              }
            }
            let spans = []
            let display = ''
            data.forEach(function (value, index) {
              if (index == 2) {
                if (value[0] === 0) {
                  spans[index] = createSpan(tests[index], testColors[value[0]], 'normal')
                } else {
                  spans[index] = createSpan(tests[index], testColors[value[0]], 'bolded')
                }
              } else {
                let style = (value[2]) ? 'bolded' : ((value[0] === notStartedGrade) ? 'normal' : 'italicizedDotted')
                spans[index] = createSpan(tests[index], testColors[value[0]], style) + createSpan('✔', checkColors[value[1]], 'none')
              }
            })
            spans.forEach(function (span, index) {
              if (index != spans.length - 1) {
                display += span + '<span> | <span>'
              } else {
                display += span
              }
            })
            return display
          } else {
            return data
          }
        }},
        {name: "readyToGrade", "title": "<span>Ready To</span><br><span>Grade</span>", className: "dt-center hasGrade search", "searchable": true, "type": "readyToGrade", "visible": true, render: function ( data, type, row ) {
          if (type === 'display') {
            return '<span style="color:' + data.color + '; font-weight: bold">' + data.text + '</span>'
          } else {
            return data.text
          }
        }},
        {name: "pregrade", "title": "Grade", className: "dt-center basicInfo hasGrade search", "searchable": true, "type": "genericEmptyUnsorted", "visible": true, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '' && grade_pregrade(data) != null) {
              let color = testColors[grade_pregrade(data)]
              return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>'
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "shipment", "title": "Shipment", className: "dt-center basicInfo searchExact", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "sector", "title": "Sector", className: "dt-center basicInfo search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "powder", "title": "W Powder", className: "dt-center tungsten search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "bucket", "title": "W Bucket #", className: "dt-center tungsten searchExact", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "moldSeries", "title": "<span>Mold</span><br><span>Series</span>", className: "dt-center  searchExact", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "emptyMoldMass", "title": "<span>Empty Mold</span><br><span>Mass (g)</span>", className: "dt-center tungsten range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "filledMoldMass", "title": "<span>Filled Mold</span><br><span>Mass (g)</span>", className: "dt-center tungsten range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "tungstenMass", "title": "W Mass (g)", className: "dt-center tungsten range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "tungstenFiller", "title": "W Filler", className: "dt-center tungsten search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "tungstenFillingDate", "title": "W Filling Date", className: "dt-center tungsten search", "searchable": true, "type": "usDateEmptyUnsorted", "visible": false},
        {name: "epoxyBatch", "title": "<span>Epoxy</span><br><span>Batch</span>", className: "dt-center epoxy searchExact", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "resinMass", "title": "<span>Resin</span><br><span>Mass (g)</span>", className: "dt-center epoxy range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "hardenerMass", "title": "<span>Hardener</span><br><span>Mass (g)</span>", className: "dt-center epoxy range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "epoxyFillingTime", "title": "<span>Epoxy Filling</span><br><span>Time (min)</span>", className: "dt-center epoxy range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "epoxyFillingDate", "title": "<span>Epoxy</span><br><span>Filling Date</span>", className: "dt-center epoxy search", "searchable": true, "type": "usDateEmptyUnsorted", "visible": false},
        {name: "epoxyPreparer", "title": "<span>Epoxy</span><br><span>Preparer</span>", className: "dt-center epoxy search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "machiningDate", "title": "<span>Machining</span><br><span>Date</span>", className: "dt-center search", "searchable": true, "type": "usDateEmptyUnsorted", "visible": false},
        {name: "dL", "title": "ΔL (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_dL(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "dBT", "title": "ΔBT (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_otherDev(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "dBB", "title": "ΔBB (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_otherDev(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "dBH", "title": "ΔBH (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_otherDev(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "dST", "title": "ΔST (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_otherDev(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "dSB", "title": "ΔSB (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_otherDev(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "dSH", "title": "ΔSH (in)", className: "dt-center density tolerances hasGrade range", "searchable": true, "type": "numericWithPlusEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              let color = testColors[grade_otherDev(data)]
              if (data > 0) {
                return '<span style="color:' + color + '; font-weight: bold">' + '+' + data + '</span>';
              } else {
                return '<span style="color:' + color + '; font-weight: bold">' + data + '</span>';
              }
            } else {
              return '<span>' + data + '</span>'
            }
          } else {
            return data
          }
        }},
        {name: "toleranceMse", "title": "Tolerance MSE", className:"dt-center range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "volume", "title": "Volume (mL)", className: "dt-center density range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "dimensionTester", "title": "<span>Dimension</span><br><span>Tester</span>", className: "dt-center density search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "mass", "title": "Mass (g)", className: "dt-center density range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "massTester", "title": "<span>Density</span><br><span>Tester</span>", className: "dt-center density search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "density", "title": "<span>Density</span><br><span>(g/mL)</span>", className: "dt-center density hasGrade range range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_density(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "densityDate", "title": "Density Date", className: "dt-center density searchExact", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "goodEnd", "title": "Good End", className: "dt-center lightTrans search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "fiberPercentage", "title": "Fiber Count (%)", className: "dt-center lightTrans hasGrade range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_fiberPercentage(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "tower1", "title": "T1 (BL) (%)", className: "dt-center lightTrans towers hasGrade range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_tower(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "tower2", "title": "T2 (BR) (%)", className: "dt-center lightTrans towers hasGrade range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_tower(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "tower3", "title": "T3 (TL) (%)", className: "dt-center lightTrans towers hasGrade range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_tower(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "tower4", "title": "T4 (TR) (%)", className: "dt-center lightTrans towers hasGrade range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_tower(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "missingRow", "title": "<span>Missing</span><br><span>Row</span>", className: "dt-center lightTrans hasGrade search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              return '<span style="color:' + testColors[grade_missingRow(data)] + '; font-weight: bold">' + TFToYesNo(data) + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return TFToYesNo(data)
          }
        }},
        {name: "thirteenHoles", "title": "<span>13 Connected</span><br><span>Holes</span>", className: "dt-center lightTrans hasGrade search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
            if (data !== '') {
              return '<span style="color:' + testColors[grade_thirteenHoles(data)] + '; font-weight: bold">' + TFToYesNo(data) + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return TFToYesNo(data)
          }
        }},
        {name: "lightTransTester", "title": "LT Tester", className: "dt-center lightTrans search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "lightTransDate", "title": "LT Date", className: "dt-center lightTrans searchExact", "searchable": true, "type": "YYYYMMDDwithSuffix", "visible": false},
        {name: "scintillation", "title": "<span>Scintillation</span><br><span>(mV)</span>", className: "dt-center scint range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false},
        {name: "scintRatio", "title": "<span>Scintillation</span><br><span>Ratio</span>", className: "dt-center scint hasGrade range", "searchable": true, "type": "numericEmptyUnsorted", "visible": false, render: function ( data, type, row ) {
          if (type === 'display') {
              if (data !== '') {
              return '<span style="color:' + testColors[grade_scintRatio(data)] + '; font-weight: bold">' + data + '</span>';
            } else {
              return '<span>' + data + '</span>'
            } 
          } else {
            return data
          }
        }},
        {name: "scintTester", "title": "<span>Scintilliation</span><br><span>Tester</span>", className: "dt-center scint search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "scintDate", "title": "<span>Scintilliation</span><br><span>Date</span>", className: "dt-center scint searchExact", "searchable": true, "type": "YYYYMMDDwithSuffix", "visible": false},
        {name: "natLightTester", "title": "NL Tester", className: "dt-center natLight search", "searchable": true, "type": "genericEmptyUnsorted", "visible": false},
        {name: "natLightDate", "title": "NL Date", className: "dt-center natLight searchExact", "searchable": true, "type": "numericEmptyUnsorted", "visible": false}
        ]
      }
      // initialize blocks table
      $(document).ready(function () {
        for (let i = 0; i < blocksTableOptions.columns.length; i++) {
          $('#blocksTable thead tr').append($('<th />'))
          $('#blocksTable tfoot tr').append($('<th />'))
        }
        let dataTable = $('#blocksTable').DataTable(blocksTableOptions)
        dataTable.columns('.search').every(function () {
          let colInitial = this
          $(colInitial.footer()).html('<input class="search" type="text" style="width: 100%" placeholder="Search" data-index="' + colInitial.index() + '"/>')
          let input = $(colInitial.footer()).find('input.search')
          input.keyup(function() {
            let currentIndex = dataTable.colReorder.transpose(parseInt(this.dataset.index))
            dataTable.column(currentIndex).search(this.value).draw()
          })
        }).columns('.searchExact').every(function() {
          let colInitial = this
          $(colInitial.footer()).html('<input class="searchExact" type="text" style="width: 100%" placeholder="Search" data-index="' + colInitial.index() + '"/>')
          let input = $(colInitial.footer()).find('input.searchExact')
          input.keyup(function() {
            let currentIndex = dataTable.colReorder.transpose(parseInt(this.dataset.index))
            //console.log('this inputs init index is ' + this.dataset.index + ' and its current index is ' + currentIndex)
            if (this.value === '') {
              dataTable.column(currentIndex).search('').draw()
            } else {
              dataTable.column(currentIndex).search('^' + this.value + '$', true, false).draw()
            }
          })
        }).columns('.range').every(function () {
          let colInitial = this
          $(colInitial.footer()).html(
            '<input class="min" type="text" style="width: 100%" placeholder="min"/>' + '<br>' + 
            '<input class="max" type="text" style="width: 100%" placeholder="max"/>'
          )
          $(colInitial.footer()).find('input.min').keyup(function() {dataTable.draw()})
          $(colInitial.footer()).find('input.max').keyup(function() {dataTable.draw()})
        })
        $('#blocksTable_wrapper > div > div > div > table > tfoot').css('display', 'none')
        dataTable.on('draw', function () {
          //$('#blocksTable_wrapper > div > div > div > table > tfoot').css('display', 'none')
        }).on( 'order', function () {
          if (arraysEqual(arrayFromFirstElements(dataTable.order()), arrayFromFirstElements(sortConfig))) {
            //console.log('reorder: sorting columns were not changed')
          } else {
            // console.log('reorder: sorting colunms were changed')
            sortConfig = [...dataTable.order()]
            filter()
          }
        }).on('search', function () {
          document.getElementById("blocksCount").innerHTML = dataTable.rows({search:'applied'}).count()
        }).on( 'column-visibility', function ( e, settings, column, state ) {
          if (!state) {
            //changed to hidden, so clear the column's search bar
            let col = dataTable.column(column)
            if ($(col.nodes()).hasClass('search')) {
              $(col.footer()).find('input.search').get(0).value = ''
              $(col.footer()).find('input.search').keyup()
            } else if ($(col.nodes()).hasClass('searchExact')) {
              $(col.footer()).find('input.searchExact').get(0).value = ''
              $(col.footer()).find('input.searchExact').keyup()
            } else if ($(col.nodes()).hasClass('range')) {
              $(col.footer()).find('input.min').get(0).value = ''
              $(col.footer()).find('input.max').get(0).value = ''
              dataTable.draw()
            }
          }
          $('#blocksTable_wrapper > div > div > div > table > tfoot').css('display', 'none')
        })
      })
      $.fn.dataTable.ext.search.push(
        function( settings, data, dataIndex ) {
          if (settings.sTableId === 'blocksTable') {
            for (let i = 0; i < settings.aoColumns.length; i++) {
              let col = settings.aoColumns[i]
              if (col.sClass.split(" ").includes('range')) {
                let min = parseFloat(col.nTf.children[0].value)
                let max = parseFloat(col.nTf.children[2].value)
                let val = parseFloat(data[i])
                if (!((isNaN(min) && isNaN(max)) ||
                  (isNaN(min) && val <= max) ||
                  (min <= val && isNaN( max)) ||
                  (min <= val && val <= max))) {
                  return false
                }
              }
            }
            return true
          } else {
            return true
          }
        }
      )
      // configuration for candidate retouch table
      const candidateRetouchTableOptions = {
        paging: false,
        buttons: [],
        scrollX: true,
        scrollY: false,
        dom: 'Brtp',
        select: false,
        columns: [
          {name: "dbn", "title": "DBN", className: "dt-center", "searchable": true, "type": "numericEmptyUnsorted", "visible": true, render: function(data, type, row) {
            return '<span style="font-weight: bold">' + data + '</span>'
          }},
          {name: "status", "title": "Status", className: "dt-center", "searchable": true, "type": "genericEmptyUnsorted", "visible": true},
          {name: "retouchStatus", "title": "Retouch Status", className: "dt-center", "searchable": true, "type": "genericEmptyUnsorted", "visible": true},
          {name: "retouchableDimensions", "title": "Retouchable Dimensions", className: "dt-left", "searchable": true, "type": "genericEmptyUnsorted", "visible": true, render: function (data, type, row) {
            let html = ''
            data.forEach(function(value, index) {
              if (index !== data.length - 1) {
                html += '<span style="font-weight: bold">' + value[0] + '</span>' + '<span>' + ': ' + value[1] + ', ' + '</span>'
              } else {
                html += '<span style="font-weight: bold">' + value[0] + '</span>' + '<span>' + ': ' + value[1] + '</span>'
              }
            })
            return html
          }}
        ]
      }
      // initialize candidate retouch table
      $(document).ready(function () {
        for (let i = 0; i < candidateRetouchTableOptions.columns.length; i++) {
          $('#candidateRetouchTable').find('thead').find('tr').append($('<th />'))
          $('#candidateRetouchTable').find('tfoot').find('tr').append($('<th />'))
        }
        $('#candidateRetouchTable').DataTable(candidateRetouchTableOptions)
      })
      // configuration for sent retouch table
      const sentRetouchTableOptions = {
        paging: false,
        buttons: [],
        scrollX: true,
        scrollY: false,
        dom: 'Brtp',
        select: false,
        columns: [
          {name: "dbn", "title": "DBN", className: "dt-center", "searchable": true, "type": "numericEmptyUnsorted", "visible": true, render: function(data, type, row) {
            return '<span style="font-weight: bold">' + data + '</span>'
          }},
          {name: "status", "title": "Status", className: "dt-center", "searchable": true, "type": "genericEmptyUnsorted", "visible": true},
          {name: "retouchableDimensions", "title": "Retouchable Dimensions", className: "dt-left", "searchable": true, "type": "genericEmptyUnsorted", "visible": true, render: function (data, type, row) {
            let html = ''
            data.forEach(function(value, index) {
              if (index !== data.length - 1) {
                html += '<span style="font-weight: bold">' + value[0] + '</span>' + '<span>' + ': ' + value[1] + ', ' + '</span>'
              } else {
                html += '<span style="font-weight: bold">' + value[0] + '</span>' + '<span>' + ': ' + value[1] + '</span>'
              }
            })
            return html
          }}
        ]
      }
      // initialize sent retouch table
      $(document).ready(function () {
        for (let i = 0; i < sentRetouchTableOptions.columns.length; i++) {
          $('#sentRetouchTable').find('thead').find('tr').append($('<th />'))
          $('#sentRetouchTable').find('tfoot').find('tr').append($('<th />'))
        }
        $('#sentRetouchTable').DataTable(sentRetouchTableOptions)
      })

      function arraysEqual (array1, array2) {
        if (array1.length !== array2.length) {
          return false
        } else {
          for (let i = 0; i < array1.length; i++) {
            if (array1[i] !== array2[i]) {
              return false
            }
          }
          return true
        }
      }
      function arrayFromFirstElements (array) {
        let toReturn = []
        for (let i = 0; i < array.length; i++) {
          toReturn[i] = array[i][0]
        }
        return toReturn
      }
      var sortConfig = [0, 'asc']
      // SORTING FUNCTIONS
      $.extend($.fn.dataTable.ext.type.order, {
        "YYYYMMDDwithSuffix-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a.includes('-')) {
            let split = a.split('-')
            a = parseInt(split[0]) + parseInt(split[1]) / 10
          }
          if (b.includes('-')) {
            let split = b.split('-')
            b = parseInt(split[0]) + parseInt(split[1]) / 10
          }
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else if (isNaN(a)) {
            return 1
          } else if (isNaN(b)) {
            return -1
          } else {
            a = parseFloat(a)
            b = parseFloat(b)
            return ((a > b) ? 1 : ((a < b) ? -1 : 0)) 
          }
        },
        "YYYYMMDDwithSuffix-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a.includes('-')) {
            let split = a.split('-')
            a = parseInt(split[0]) + parseInt(split[1]) / 10
          }
          if (b.includes('-')) {
            let split = b.split('-')
            b = parseInt(split[0]) + parseInt(split[1]) / 10
          }
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else if (isNaN(a)) {
            return 1
          } else if (isNaN(b)) {
            return -1
          } else {
            a = parseFloat(a)
            b = parseFloat(b)
            return ((a < b) ? 1 : ((a > b) ? -1 : 0)) 
          }
        },
        "numericEmptyUnsorted-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else if (isNaN(a)) {
            return 1
          } else if (isNaN(b)) {
            return -1
          } else {
            a = parseFloat(a)
            b = parseFloat(b)
            return ((a > b) ? 1 : ((a < b) ? -1 : 0)) 
          }
        },
        "numericEmptyUnsorted-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else if (isNaN(a)) {
            return -1
          } else if (isNaN(b)) {
            return 1
          } else {
            a = parseFloat(a)
            b = parseFloat(b)
            return ((a < b) ? 1 : ((a > b) ? -1 : 0)) 
          }
        },
        "genericEmptyUnsorted-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            return ((a > b) ? 1 : ((a < b) ? -1 : 0)) 
          }
        },
        "genericEmptyUnsorted-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            return ((a < b) ? 1 : ((a > b) ? -1 : 0)) 
          }
        },
        "usDateEmptyUnsorted-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            a = usDateToYYYYMMDD(a)
            b = usDateToYYYYMMDD(b)
            return ((a > b) ? 1 : ((a < b) ? -1 : 0)) 
          }
        },
        "usDateEmptyUnsorted-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            a = usDateToYYYYMMDD(a)
            b = usDateToYYYYMMDD(b)
            return ((a < b) ? 1 : ((a > b) ? -1 : 0)) 
          }
        },
        "numericWithPlusEmptyUnsorted-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            a = parseFloatRemovePlus(a)
            b = parseFloatRemovePlus(b)
            return ((a > b) ? 1 : ((a < b) ? -1 : 0)) 
          }
        },
        "numericWithPlusEmptyUnsorted-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            a = parseFloatRemovePlus(a)
            b = parseFloatRemovePlus(b)
            return ((a < b) ? 1 : ((a > b) ? -1 : 0)) 
          }
        },
        "block-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            a = parseInt(a)
            b = parseInt(b)
            return ((a === 123) ? -1 : ((b === 123) ? 1 : ((a > b) ? 1 : ((a < b) ? -1 : 0))))
          }
        },
        "block-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            a = parseInt(a)
            b = parseInt(b)
            return ((a === 123) ? 1 : ((b === 123) ? -1 : ((a < b) ? 1 : ((a > b) ? -1 : 0))))
          }
        },
        "status-asc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            return ((a === '0') ? 1 : ((b === '0') ? -1 : ((a > b) ? 1 : ((a < b) ? -1 : 0))))
          }
        },
        "status-desc": function (a, b) {
          a = (new DOMParser).parseFromString(a, 'text/html').documentElement.textContent
          b = (new DOMParser).parseFromString(b, 'text/html').documentElement.textContent
          if (a === b) {
            return 0
          } else if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            return ((a === '0') ? 1 : ((b === '0') ? -1 : ((a < b) ? 1 : ((a > b) ? -1 : 0))))
          }
        },
        "testingStatus-desc": function (status, otherStatus) {
          if (status === '') {
            return 1
          } else if (otherStatus === '') {
            return -1
          } else {
            let index = indexFromTestingStatus(status)
            let otherIndex = indexFromTestingStatus(otherStatus)
            return (index > otherIndex) ? 1 : ((index < otherIndex) ? -1 : 0)  
          }
        },
        "testingStatus-asc": function (status, otherStatus) {
          if (status === '') {
            return 1
          } else if (otherStatus === '') {
            return -1
          } else {
            let index = indexFromTestingStatus(status)
            let otherIndex = indexFromTestingStatus(otherStatus)
            return (index < otherIndex) ? 1 : ((index > otherIndex) ? -1 : 0)  
          }
        },
        "readyToGrade-desc": function (a, b) {
          if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            index = readyToGradeMap.get(a)
            otherIndex = readyToGradeMap.get(b)
            return (index > otherIndex) ? 1 : ((index < otherIndex) ? -1 : 0)  
          }
        },
        "readyToGrade-asc": function (a, b) {
          if (a === '') {
            return 1
          } else if (b === '') {
            return -1
          } else {
            index = readyToGradeMap.get(a)
            otherIndex = readyToGradeMap.get(b)
            return (index < otherIndex) ? 1 : ((index > otherIndex) ? -1 : 0)  
          }
        }
      });
      // sorting helper functions
      const readyToGradeMap = new Map([['Needs Tests', 1], ['Needs Checks', 2], ['Ready', 3]])
      function parseFloatRemovePlus (string) {
        if (string[0] === '+') {
          return parseFloat(string.substr(1))
        } else {
          return parseFloat(string)
        }
      }
      function to2digits (string) {
        if (string.length < 2) {
          return '0' + string
        } else {
          return string
        }
      }
      function usDateToYYYYMMDD (usDate, sheet, dbn, col) {
        let splitDate = usDate.split('/')
        if (splitDate.length === 3) {
          let month = to2digits(splitDate[0])
          let day = to2digits(splitDate[1])
          let year = splitDate[2]
          return parseInt(year + month + day)
        } else {
          console.log("helpful hint of the day: '" + usDate + "' is NOT a date (sheet " + sheet + ", DBN " + dbn + ", column " + col + ")")
          return null
        }
      }
      function dateToYYYYMMDD (date) {
        let y = date.getFullYear().toString()
        let m = (date.getMonth() + 1).toString()
        let d = date.getDate().toString()
        if (m.length === 1) {m = '0' + m}
        if (d.length === 1) {d = '0' + d}
        return parseInt(y + m + d)
      }
      function YYYYMMDDtoDate (int) {
        str = int.toString()
        return new Date(parseInt(str.toString().substr(0, 4)), parseInt(str.toString().substr(4, 2)) - 1, parseInt(str.toString().substr(6, 2)))
      }
      function makeFileFriendly (date) {
        return date.getFullYear() + '-' + to2digits((date.getMonth() + 1).toString()) + '-' +  to2digits(date.getDate().toString())
          + 'T' + date.toTimeString().substr(0, 8).replace(':', '').replace(':', '')
      }
      function removeSuffix(string) {
        return string.split(/[.-]/)[0]
      }
      function arrayToStringList (array) {
        let string = ''
        for (let i = 0; i < array.length - 1; i++) {
          string += array[i] + ', '
        }
        if (array.length > 0) {
          string += array[array.length - 1]
        }
        return string
      }
      function wToWide (string) {
        if (string.toUpperCase() === 'W') {
          return 'Wide'
        } else if (string.toUpperCase() === 'N') {
          return 'Narrow'
        } else {
          return string
        }
      }
      function TFToYesNo (boolean) {
        if (boolean == null) {
          return ''
        } else if (boolean) {
          return 'Yes'
        } else {
          return 'No'
        }
      }
      function indexFromTestingStatus (status) {
        let hasFail
        let testsComplete = 0
        let testsChecked = 0
        let testsStarted = 0
        hasFail = !status.every((value) => value[0] !== 3)
        status.forEach(function (value, index) {
          if (index !== 2 && value[2] === 1) {
            testsComplete++
          } else if (index === 2 && value[0] !== 0) {
            testsComplete++
          }
        })
        status.forEach(function (value, index) {
          if (index !== 2 && value[1] === 1) {
            testsChecked++
          }
        })
        status.forEach(function (value, index) {
          if (value[0] !== 0) {
            testsStarted++
          }
        })
        return (100 * testsComplete + 10 * testsChecked + testsStarted)
      }
	</script>
</head>

<body onload="getDatabaseOnLoad()" style="margin: 1em;">
	<div class="header" style="display: block; padding: 1em; overflow: auto;">
		<img src="https://drive.google.com/uc?id=1JLX7vfDnqgYd_OrgPNtvj1sqV8n4ANpd"/>
		<h1>NPL Block Information Station</h1>
	</div>
	<div>
		<p id="loadingDatabase" style="margin-bottom: 1em; display: none;">Loading Database...</p>
		<p id="currentDateAndTime" style="margin: 0; display: none;"></p>
	</div>
	<section id="findBlockInfo" style="display: none;">
		<button class="removeForPrint" id="loadFindBlocksButton" onclick="loadFindBlocks()" style="margin-top: 1em;">Find Blocks</button>
		<button class="removeForPrint" id="loadRetouchButton" onclick="loadRetouch()" style="margin-top: 1em;">Retouch Information</button>
		<button class="removeForPrint" id="loadDateRangeButton" onclick="loadDateRange()" style="margin-top: 1em;">Date Range</button><br>
		<section style="display: inline-block; margin-top: 1em;">
			<form action="javascript:onSubmit()" style="display: inline;">
				<label>DBN: </label><input type="text" id="inputDBN">
				<button class="removeForPrint" id="dbnSubmitButton">Submit</button>
			</form>
			<button class="removeForPrint" id="loadAllImagesButton" onclick="madness()">Load All Images</button>
			<button class="removeForPrint" id="printButton" onclick="toPrint()" style="margin-left: 0;">Print</button>
		</section>
		<p id="loadingBlockData" style="display: none;">Loading Block Data...</p>
		<section class="removeForPrint" id="imagesSelection" style="display: none;  margin-top: 1em;">
			<section id="allCheckboxes" style="display: none;">
				<section id="CBshow-lightTransImgSection" style="display: none;">
					<input type="checkbox" id="CBshow-lightTransImg" onclick="toggleImages('lightTransImg')">
					<label for="CBshow-lightTransImg" id="CBshow-lightTransImgLabel">Show Light Transmission Original Images</label><br>
          </section>
					<section id="CBshow-lightTransImgCroppedSection" style="display: none;">
						<input type="checkbox" id="CBshow-lightTransImgCropped" onclick="toggleImages('lightTransImgCropped')">
						<label for="CBshow-lightTransImgCropped" id="CBshow-lightTransImgCroppedLabel">Show Light Transmission Cropped Images</label><br>
          </section>
						<section id="CBshow-natLightImgSection" style="display: none;">
							<input type="checkbox" id="CBshow-natLightImg" onclick="toggleImages('natLightImg')">
							<label for="CBshow-natLightImg" id="CBshow-natLightImgLabel">Show Natural Light Images</label>
						</section>
					</section>
					<div id="loadingImages" style="display: none;">Loading Images...</div>
					<div id="noImagesFound" style="display: none;">No Images Found</div>
				</section>
				<section id="blockDetailsSection" style="display: none;">
					<h2>Block Details</h2>
					<dl class='inline-flex'>
						<dt id='dbnLabel'>DBN:</dt>
						<dd id="dbn"></dd>
						<dt id='blockLabel'>Block Design:</dt>
						<dd id="block"></dd>
						<dt id='statusLabel'>Status:</dt>
						<dd id="status"></dd>
						<dt id='pregradeLabel'>Pregrade:</dt>
						<dd id="pregrade"></dd>
						<dt id="shipmentLabel">BNL Shipment:</dt>
						<dd id="shipment"></dd>
						<dt id="sectorLabel">Sector:</dt>
						<dd id="sector"></dd>
						<dt id="commentLabel">Comment:</dt>
						<dd id="comment"></dd>
						<section style="width: 100%; padding-top: 1em;">
							<button class="removeForPrint" id="showTungstenTableBtn" style="display: none;" onclick="toggleTungstenTable()">Show Tungsten Powder Information</button>
							<table class="dimension" id="tungstenTable"
								style="display: none; padding-top: 1em; border-collapse: collapse; fill: #333;">
								<tr>
									<th style="white-space: nowrap;">Powder</th>
									<th style="white-space: nowrap;">Bucket Number</th>
									<th style="white-space: nowrap;">Mold Series</th>
									<th style="white-space: nowrap;">Empty Mold Mass (g)</th>
									<th style="white-space: nowrap;">Filled Mold Mass (g)</th>
									<th style="white-space: nowrap;">Tungsten Mass (g)</th>
									<th style="white-space: nowrap;">Filler</th>
									<th style="white-space: nowrap;">Filling Date</th>
								</tr>
								<tr>
									<td id="powder"></td>
									<td id="bucket"></td>
									<td id="moldSeries"></td>
									<td id="emptyMoldMass"></td>
									<td id="filledMoldMass"></td>
									<td id="tungstenMass"></td>
									<td id="tungstenFiller"></td>
									<td id="tungstenFillingDate"></td>
								</tr>
							</table>
						</section>
						<section style="width: 100%; padding: 1em 0;">
							<button class="removeForPrint" id="showEpoxyTableBtn" style="display: none;" onclick="toggleEpoxyTable()">Show Epoxy Information</button>
							<table class="dimension" id="epoxyTable"
								style="display: none; padding-top: 1em; border-collapse: collapse; fill: #333;">
								<tr>
									<th style="white-space: nowrap;">Epoxy Batch</th>
									<th style="white-space: nowrap;">Resin Mass (g)</th>
									<th style="white-space: nowrap;">Hardener Mass (g)</th>
									<th style="white-space: nowrap;">Potting Notes</th>
									<th style="white-space: nowrap;">Epoxy Filling Time (min)</th>
									<th style="white-space: nowrap;">Filling Date</th>
									<th style="white-space: nowrap;">Preparer</th>
								</tr>
								<tr>
									<td id="epoxyBatch"></td>
									<td id="resinMass"></td>
									<td id="hardenerMass"></td>
									<td id="pottingNotes"></td>
									<td id="epoxyFillingTime"></td>
									<td id="epoxyFillingDate"></td>
									<td id="epoxyPreparer"></td>
								</tr>
							</table>
						</section>
						<dt id="machiningDateLabel">Machining Date: </dt>
						<dd id="machiningDate"></dd>
					</dl>
				</section>
				<section id="blockDetailsNoInfo" style="display: none;">
					<p style="font-style: italic; font-size: 1.5em;">Unable to find any block information for this dbn
					</p>
				</section>
				<section id="densitySection" style="display: none;">
					<h2 id="densitySectionLabel">Density</h2>
					<dl class='inline-flex'>
						<dt id='volumeLabel'>Volume:</dt>
						<dd id="volume"></dd>
						<dt id='dimensionTesterLabel'>Dimension Tester:</dt>
						<dd id="dimensionTester"></dd>
						<dt id='massLabel'>Mass:</dt>
						<dd id="mass"></dd>
						<dt id='massTesterLabel'>Mass Tester:</dt>
						<dd id="massTester"></dd>
						<dt id='densityLabel'>Density:</dt>
						<dd id="density" style="font-weight: bold;"></dd>
						<dt id='densityDateLabel'>Date:</dt>
						<dd id="densityDate"></dd>
					</dl>
					<button class="removeForPrint" id="showTolerancesTableBtn" style="display: none;" onclick="toggleTolerancesTable()">Show Tolerances</button>
					<table class="dimension" id="tolerancesTable"
						style="display: none; padding-top: 1em; border-collapse: collapse; fill: #333;">
						<tr>
							<th>ΔL</th>
							<th>ΔBT</th>
							<th>ΔBB</th>
							<th>ΔBH</th>
							<th>ΔST</th>
							<th>ΔSB</th>
							<th>ΔSH</th>
						</tr>
						<tr>
							<td id="L" style="font-weight: bold;"></td>
							<td id="BT" style="font-weight: bold;"></td>
							<td id="BB" style="font-weight: bold;"></td>
							<td id="BH" style="font-weight: bold;"></td>
							<td id="ST" style="font-weight: bold;"></td>
							<td id="SB" style="font-weight: bold;"></td>
							<td id="SH" style="font-weight: bold;"></td>
						</tr>
					</table>
				</section>
				<section id="densityNoInfo" style="display: none;">
					<p style="font-style: italic; font-size: 1.5em;">Unable to find any density data for this block</p>
				</section>
				<section id="lightTransSection" style="display: none;">
					<h2 id="lightTransSectionLabel">Light Transmission</h2>
					<dl class='inline-flex'>
						<dt id='fiberPercentageLabel'>Fiber Count:</dt>
						<dd id="fiberPercentage" style="font-weight: bold;"></dd>
						<dt id='goodEndLabel'>Good End:</dt>
						<dd id="goodEnd"></dd>
						<dt id='missingRowLabel'>Missing Row:</dt>
						<dd id="missingRow" style="font-weight: bold;"></dd>
						<dt id='thirteenHolesLabel'>13 Connected Holes:</dt>
						<dd id="thirteenHoles" style="font-weight: bold;"></dd>
						<dt id='lightTransTesterLabel'>Tester:</dt>
						<dd id="lightTransTester"></dd>
						<dt id='lightTransDateLabel'>Date:</dt>
						<dd id="lightTransDate"></dd>
					</dl>
					<button class="removeForPrint" id="showTowerTableBtn" style="display: none; margin-bottom: 1em;" onclick="toggleTowerTable()">Show Tower Information</button>
					<table class="dimension" id="towerTable"
						style="display: none; margin-bottom: 1em; border-collapse: collapse; fill: #333;">
						<tr>
							<th>T1 (BL)</th>
							<th>T2 (BR)</th>
							<th>T3 (TL)</th>
							<th>T3 (TR)</th>
						</tr>
						<tr>
							<td id="tower1" style="font-weight: bold;"></td>
							<td id="tower2" style="font-weight: bold;"></td>
							<td id="tower3" style="font-weight: bold;"></td>
							<td id="tower4" style="font-weight: bold;"></td>
						</tr>
					</table>
					<a id="histogramWide" target="_blank" style="display: none;">Histograms (Wide)<br></a>
						<a id="histogramNarrow" target="_blank" style="display: none;;">Histograms (Narrow)</a>
						<figure class="testImg" id="lightTransImgFigW" style="display: none;">
							<img id="lightTransImgW" height="360"/>
							<figcaption>Wide End</figcaption>
						</figure>
						<figure class="testImg" id="lightTransImgFigN" style="display: none;">
							<img id="lightTransImgN" height="360"/>
							<figcaption>Narrow End</figcaption>
						</figure>
						<figure class="testImg" id="lightTransImgCroppedFigW" style="display: none;">
							<img id="lightTransImgCroppedW" height="360"/>
							<figcaption>Wide End</figcaption>
						</figure>
						<figure class="testImg" id="lightTransImgCroppedFigN" style="display: none;">
							<img id="lightTransImgCroppedN" height="360"/>
							<figcaption>Narrow End</figcaption>
						</figure>
				</section>
				<section id="lightTransNoInfo" style="display: none;">
					<p style="font-style: italic; font-size: 1.5em;">Unable to find any light transmission data for this
						block</p>
				</section>
				<section id="natLightSection" style="display: none;">
					<h2>Natural Light</h2>
					<dl class='inline-flex'>
						<dt id='natLightTesterLabel'>Tester:</dt>
						<dd id="natLightTester"></dd>
						<dt id='natLightDateLabel'>Date:</dt>
						<dd id="natLightDate"></dd>
					</dl>
					<figure class="testImg" id="natLightImgFigW" style="display: none;">
						<img id="natLightImgW" height="360"/>
						<figcaption id="natLightImgFigCaption4">Wide End</figcaption>
					</figure>
					<figure class="testImg" id="natLightImgFigN" style="display: none;">
						<img id="natLightImgN" height="360"/>
						<figcaption id="natLightImgFigCaption5">Narrow End</figcaption>
					</figure>
				</section>
				<section id="natLightNoInfo" style="display: none;">
					<p style="font-style: italic; font-size: 1.5em;">Unable to find any natural light data for this
						block</p>
				</section>
				<section id="scintSection" style="display: none;">
					<h2 id="scintSectionLabel">Scintillation</h2>
					<dl class='inline-flex'>
						<dt id='scintillationLabel'>Scintillation:</dt>
						<dd id="scintillation"></dd>
						<dt id='scintRatioLabel'>Ratio:</dt>
						<dd id="scintRatio" style="font-weight: bold;"></dd>
						<dt id='scintTesterLabel'>Tester:</dt>
						<dd id="scintTester"></dd>
						<dt id='scintDateLabel'>Date:</dt>
						<dd id="scintDate"></dd>
					</dl>
				</section>
				<section id="scintNoInfo" style="display: none;">
					<p style="font-style: italic; font-size: 1.5em;">Unable to find any scintillation data for this
						block</p>
				</section>
			</section>
			<section id="findBlocks" style="display: none;">
				<button onclick="loadFindBlockInfo()" style="margin: 1em 0em;">Back</button><br>
				<form action="javascript:filter()" style="display: inline;">
					<label style="display: inline-block; width: 90px;">DBN: </label><input style="width: 240px;" type="text" tabindex="1" id="inputDBNs">
					<button>Submit</button>
				</form>
				<button onclick="clearInputDBNs()" style="display: inline;">Clear</button><br>
				<form action="javascript:filter()" style="display: inline;">
					<label style="display: inline-block; width: 90px;">Shipment: </label><input style="width: 240px;" type="text" tabindex="2" id="inputShipment">
					<button>Submit</button>
				</form>
				<button onclick="clearInputShipment()" style="display: inline;">Clear</button><br>
				<form action="javascript:filter()" style="display: inline;">
					<label style="display: inline-block; width: 90px;">Status: </label><input style="width: 240px;" type="text" tabindex="3" id="inputStatus">
					<button>Submit</button>
				</form>
				<button onclick="clearInputStatus()" style="display: inline;">Clear</button><br>
				<form action="javascript:filter()" style="display: inline;">
					<label style="display: inline-block; width: 90px;">Block Design: </label><input style="width: 240px;" type="text" tabindex="4" id="inputBlock">
					<button>Submit</button>
				</form>
				<button onclick="clearInputBlock()" style="display: inline;">Clear</button><br>
				<input id="showRowsCB" type="checkbox" style="margin-top: 1em;" onclick="toggleShowRows()"><label for="showRowsCB">Show rows with empty cells in selected column(s)</label>
				<section style="margin: 1em 0em">
					<span>Blocks Found:</span>
					<span id="blocksCount"></span>
				</section>
				<table id="blocksTable" class="nowrap stripe hover order-column row-border cell-border"
					style="width: 100%;">
					<thead>
						<tr></tr>
					</thead>
					<tbody id="blocksTableBody"></tbody>
					<tfoot>
						<tr></tr>
					</tfoot>
				</table>
			</section>
			<section id="findRetouch" style="display: none;">
				<button onclick="loadFindBlockInfo()" style="margin: 1em 0em;">Back</button><br>
				<table id="candidateRetouchTable" class="nowrap display cell-border" style="width: 100%;">
					<caption style="text-align: center; font-weight: bold; background-color: lightgrey; padding: 8px;">
						Blocks Needing Retouch: <span id="candidateRetouchCount"></span></caption>
					<thead>
						<tr></tr>
					</thead>
					<tbody></tbody>
					<tfoot>
						<tr></tr>
					</tfoot>
				</table>
				<table id="sentRetouchTable" class="nowrap display cell-border" style="width: 100%;">
					<caption style="text-align: center; font-weight: bold; background-color: lightgrey; padding: 8px;">
						Blocks Sent For Retouch: <span id="sentRetouchCount"></span></caption>
					<thead>
						<tr></tr>
					</thead>
					<tbody></tbody>
				</table>
			</section>
			<section id="dateRange" style="display: none;">
				<button onclick="loadFindBlockInfo()" style="margin: 1em 0em;">Back</button><br>
				<form action="javascript:calcDateRange()" style="display: inline;">
					<label>From: </label><input type="text" id="fromDate" style="width: 70px;">
					<label>To: </label><input type="text" id="toDate" style="width: 70px;">
					<button id="dateRangeSubmitButton">Submit</button>
				</form><br>
				<form action="javascript:calcLastDays()" style="display: inline;">
					<label>Last </label><input type="text" id="lastDays" style="width: 24px;"><label> Weekdays</label>
					<button>Submit</button>
				</form><br>
				<button onclick="changeWeek(-1)">Previous Week</button>
				<button onclick="calcThisWeek()">Current Week</button>
				<button onclick="changeWeek(1)">Next Week</button>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Tungsten Filled: </span><span id="tungstenFilledDateRangeCount">0</span>
					<p id="tungstenFilledDateBlocks"></p>
					<button onclick="copy(document.getElementById('tungstenFilledDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('tungstenFilledDateBlocks').innerHTML)">Get Info</button>
				</div>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Epoxy Filled: </span><span id="epoxyFilledDateRangeCount">0</span>
					<p id="epoxyFilledDateBlocks"></p>
					<button onclick="copy(document.getElementById('epoxyFilledDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('epoxyFilledDateBlocks').innerHTML)">Get Info</button>
				</div>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Machined: </span><span id="machinedDateRangeCount">0</span>
					<p id="machinedDateBlocks"></p>
					<button onclick="copy(document.getElementById('machinedDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('machinedDateBlocks').innerHTML)">Get Info</button>
				</div>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Density Tested: </span><span id="densityTestedDateRangeCount">0</span>
					<p id="densityTestedDateBlocks"></p>
					<button onclick="copy(document.getElementById('densityTestedDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('densityTestedDateBlocks').innerHTML)">Get Info</button>
				</div>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Light Transmission Tested: </span><span id="lightTransTestedDateRangeCount">0</span>
					<p id="lightTransTestedDateBlocks"></p>
					<button onclick="copy(document.getElementById('lightTransTestedDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('lightTransTestedDateBlocks').innerHTML)">Get Info</button>
				</div>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Scintillation Tested: </span><span id="scintTestedDateRangeCount">0</span>
					<p id="scintTestedDateBlocks"></p>
					<button onclick="copy(document.getElementById('scintTestedDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('scintTestedDateBlocks').innerHTML)">Get Info</button>
				</div>
				<div style="margin: 1em 0; padding: 1em; border: 1px solid black;">
					<span style="font-weight: bold;">Natural Light Tested: </span><span id="natLightTestedDateRangeCount">0</span>
					<p id="natLightTestedDateBlocks"></p>
					<button onclick="copy(document.getElementById('natLightTestedDateBlocks').innerHTML)">Copy</button><button onclick="findBlocksFromList(document.getElementById('natLightTestedDateBlocks').innerHTML)">Get Info</button>
				</div>
			</section>
			<script>
				function toPrint() {
        var printPreview = window.open()
        var printDocument = printPreview.document
        printDocument.open()
        let html = $(document.documentElement.cloneNode(true))
        html.find('body').attr('onload', 'print()')
        let dbn = document.getElementById('inputDBN').value
        html.find('head title').html('BlockReport-DBN_' + dbn + '-asOf_' + makeFileFriendly(currentDate))
        html.find('script').eq(1).remove()
        html.find('script').eq(6).remove()
        html.find('.removeForPrint').remove()
        html.find('#inputDBN').prop('disabled', true).attr('value', dbn)
        printDocument.write('<!DOCTYPE html>' + '<html>' + html.html() + '</html>')
        printDocument.close()
      }
      function copy(text) {
        var textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.top = "0";
        textArea.style.left = "0";
        textArea.style.position = "fixed";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          let successful = document.execCommand('copy');
          let msg = successful ? 'successful' : 'unsuccessful';
        } catch (err) {
          console.error('unable to copy:', err);
        }
        document.body.removeChild(textArea);
      }
      // store each section's ID in an array for easy iteration:
      const allSectionPrefixes = ['blockDetails', 'density', 'lightTrans', 'natLight', 'scint']
      // store all image prefixes in an array for easy iteration
      const allImagePrefixes = ['lightTransImg', 'lightTransImgCropped', 'natLightImg']
      // store all testing image IDs in an array for easy iteration:
      const allTestingImgs = ['lightTransImgW', 'lightTransImgN', 'lightTransImgCroppedW', 'lightTransImgCroppedN', 'natLightImgW', 'natLightImgN']
      // converts a status number to english so it can be added to the block information (the suffix that appears after the status number)
      const statusMap = new Map([
        ['0','(fiber set)'],
        ['1','(fibers in mold)'],
        ['2','(tungsten in mold)'],
        ['3','(potted)'],
        ['4','(machining)'],
        ['5','(ready for testing)'],
        ['5a','(tested A-grade)'],
        ['5b','(tested B-grade)'],
        ['5c','(tested C-grade)'],
        ['5r','(review)'],
        ['5m','(monitoring)'],
        ['6','(ready to be shipped)'],
        ['7','(shipped, at BNL)'],
        ['8','(graveyard)']
      ])
      // maximum DBN (reject dbns larger than this)
      var maxDbn = 3498
      // zero index column number for "block" column
      const databaseBlockColIndex = 2
      // array [Blocks DB, Blocks1364DB], where each element is a (large) 2D array
      var database
      //
      var blocksCollection
      // stores the expected dimensions for each block type
      //BL     L        BT      BB      BH      ST      SB      SH
      const dimensionsMap = new Map([
      [123, [5.5000,	2.0850,	2.0850,	1.9890,	1.8150,	1.8150,	1.9890]],
      [  4, [5.4460,	2.0850,	2.0820,	2.2740,	1.8180,	1.8150,	1.9900]],
      [  5, [5.3500,	2.0850,	2.0760,	2.2630,	1.8230,	1.8150,	1.9900]],
      [  6, [5.2700,	2.0850,	2.0710,	2.2530,	1.8280,	1.8150,	1.9900]],
      [  7, [5.2050,	2.0850,	2.0650,	2.2430,	1.8320,	1.8150,	1.9900]],
      [  8, [5.1550,	2.0850,	2.0600,	2.2340,	1.8370,	1.8150,	1.9890]],
      [  9, [5.1180,	2.0850,	2.0560,	2.2250,	1.8410,	1.8150,	1.9890]],
      [ 10, [5.0940,	2.0850,	2.0510,	2.2160,	1.8460,	1.8150,	1.9890]],
      [ 11, [5.0820,	2.0850,	2.0470,	2.2080,	1.8500,	1.8150,	1.9890]],
      [ 12, [5.0810,	2.0850,	2.0420,	2.2010,	1.8530,	1.8150,	1.9890]],
      [ 13, [5.0900,	2.0850,	2.0390,	2.1930,	1.8570,	1.8150,	1.9890]],
      [ 14, [5.1100,	2.0850,	2.0350,	2.1860,	1.8600,	1.8150,	1.9890]],
      [ 15, [5.1390,	2.0850,	2.0320,	2.1800,	1.8640,	1.8150,	1.9890]],
      [ 16, [5.1770,	2.0850,	2.0280,	2.1740,	1.8670,	1.8150,	1.9890]],
      [ 17, [5.2240,	2.0850,	2.0250,	2.1680,	1.8700,	1.8150,	1.9890]],
      [ 18, [5.2790,	2.0850,	2.0230,	2.1620,	1.8720,	1.8150,	1.9890]],
      [ 19, [5.3420,	2.0850,	2.0200,	2.1570,	1.8750,	1.8150,	1.9890]],
      [ 20, [5.4120,	2.0850,	2.0180,	2.1520,	1.8770,	1.8150,	1.9890]],
      [ 21, [5.4890,	2.0850,	2.0150,	2.1470,	1.8790,	1.8150,	1.9890]],
      [ 22, [5.5720,	2.0850,	2.0130,	2.1420,	1.8810,	1.8150,	1.9890]],
      [ 23, [5.6620,	2.0850,	2.0120,	2.1380,	1.8830,	1.8150,	1.9890]],
      [ 24, [5.7580,	2.0850,	2.0100,	2.1330,	1.8850,	1.8150,	1.9890]]
      ])
      // changes to true when the "do not press" button is pressed, which changes the way image urls are obtained
      var slowMode = false
      //
      var currentDate
      // called when the web page is loaded—loads the database
      function getDatabaseOnLoad() {
        // create a timestamp to display     
        currentDate = new Date()
        document.getElementById("currentDateAndTime").innerHTML = 'As of: ' + currentDate.toString()
        document.getElementById("currentDateAndTime").style.display = 'block'
        document.getElementById('loadingDatabase').style.display = 'block'
        google.script.run.withSuccessHandler(onSuccess).getDatabase()
        function onSuccess (gotDatabase) {
          const d1 = new Date()
          if (gotDatabase == null) {
            alert('oops, fn gotDatabase returned null! unable to load database and testing folders from drive')
            document.getElementById('loadingDatabase').style.display = 'none'
            return
          } else if (gotDatabase.err != null) {
            // an error occured, so display an alert with the error message passed from script
            alert('an error occured while loading the database and testing fodlers: ' + gotDatabase.err)
            document.getElementById('loadingDatabase').style.display = 'none'
          } else {
            console.log('loaded database and testing folders without error')
            database = [gotDatabase.sheet1, gotDatabase.sheet2]
            times = gotDatabase.times
            console.log('load files took ' + (times[1] - times[0])/1000 + ' s')
            console.log('load files to success: ' + (d1.getTime() - times[1])/1000 + ' s')
            let blocks = []
            for (let index = 1; index < database[0].length; index++) {
              if (database[0][databaseBlockColIndex] !== '') {
                blocks[index - 1] = new Block(database[0][index], 0, index - 1)
              }
            }
            for (let index = 1; index < database[1].length; index++) {
              if (database[1][databaseBlockColIndex] !== '') {
                blocks[index + 1999] = new Block(database[1][index], 1, index + 1999)
              }
            }
            blocksCollection = new BlocksCollection(blocks)
            document.getElementById('loadingDatabase').style.display = 'none'
            document.getElementById('findBlockInfo').style.display = 'block'
            calcThisWeek()
          }
        }
      }
      
      // called when enter is pressed in text box or submit button is clicked
      function onSubmit() {
        // load the database if it hasn't been loaded
        if (database == null) {
          getDatabaseOnLoad()
          afterOnSubmit()
        } else {
          afterOnSubmit()
        }
        function afterOnSubmit () {
          // show that we're loading the block data
          document.getElementById("loadingBlockData").style.display = 'block'
          // grab the dbn from the input box
          var dbn = document.getElementById("inputDBN").value
          console.log('fetching information for DBN ' + dbn)
          // hide all block info and noInfo sections for them to be loaded if needed by loadTestingData
          for (let i = 0; i < allSectionPrefixes.length; i++) {
            document.getElementById(allSectionPrefixes[i] + 'Section').style.display = 'none'
            document.getElementById(allSectionPrefixes[i] + 'NoInfo').style.display = 'none'
          }
          // hide imagesSelection section for it to be loaded if needed by loadTestingData
          document.getElementById("imagesSelection").style.display = 'none'
          // and reset the checkboxes
          resetCheckboxes()
          // and reset text that isn't automatically reset in imagesSelection section
          document.getElementById("noImagesFound").style.display = 'none'
          document.getElementById("histogramWide").style.display = 'none'
          document.getElementById("histogramWide").href = '#'
          document.getElementById("histogramNarrow").style.display = 'none'
          document.getElementById("histogramNarrow").href = '#'
          // and reset the img src urls just in case one happens to be shown but on overwritten
          // (e.g. one LT cropped image returns a url and the other does not (e.g. DBN 78))
          for (let i = 0; i < allTestingImgs.length; i++) {
            document.getElementById(allTestingImgs[i]).src = '#'
          }
          // run loadTestingDataAsStringifiedJson and pass it's return data to a success handler
          console.log('loading testing data')
          loadTestingData(dbn)
        }
      }
      // Checks if a value (say, returned by a map) is significant (not null, empty, #NUM!, or #DIV/0!)
      function dataPresent (data) {
        return (data != null && data != '' && data != '#NUM!' && data != '#DIV/0!' && data != 'NaN')
      }
      // loads testing data, updates fields, and unhides relevant sections based on the data present
      function loadTestingData (stringDBN) {
        let block = blocksCollection.getBlockByStringDBN(stringDBN)
        if (block == null) {
          alert('unable to find that block')
          document.getElementById("loadingBlockData").style.display = 'none'
          return
        }
        let getImageUrlsRun = false
        // BLOCK DETAILS
        const tungstenTableEntries = ['powder', 'bucket', 'moldSeries', 'emptyMoldMass', 'filledMoldMass', 'tungstenMass', 'tungstenFiller', 'tungstenFillingDate']
        const epoxyTableEntries = ['epoxyBatch', 'resinMass', 'hardenerMass', 'pottingNotes', 'epoxyFillingTime', 'epoxyFillingDate', 'epoxyPreparer']
        document.getElementById("blockDetailsSection").style.display = 'block'
        //block details
        if (block.dbn != null) {
          document.getElementById('dbn').innerHTML = block.dbn
          document.getElementById('dbn').style.display = 'inline'
          document.getElementById('dbn' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('dbn').style.display = 'none'
          document.getElementById('dbn' + 'Label').style.display = 'none'
        }
        if (block.block != null) {
          document.getElementById('block').innerHTML = block.block
          document.getElementById('block').style.display = 'inline'
          document.getElementById('block' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('block').style.display = 'none'
          document.getElementById('block' + 'Label').style.display = 'none'
        }
        if (block.status != null) {
          document.getElementById('status').innerHTML = block.status + ' ' + statusMap.get(block.status)
          document.getElementById('status').style.display = 'inline'
          document.getElementById('status' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('status').style.display = 'none'
          document.getElementById('status' + 'Label').style.display = 'none'
        }
        if (block.shipment != null) {
          document.getElementById('shipment').innerHTML = block.shipment
          document.getElementById('shipment').style.display = 'inline'
          document.getElementById('shipment' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('shipment').style.display = 'none'
          document.getElementById('shipment' + 'Label').style.display = 'none'
        }
        if (block.sector != null) {
          document.getElementById('sector').innerHTML = block.sector
          document.getElementById('sector').style.display = 'inline'
          document.getElementById('sector' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('sector').style.display = 'none'
          document.getElementById('sector' + 'Label').style.display = 'none'
        }
        if (block.comment != null) {
          document.getElementById('comment').innerHTML = block.comment
          document.getElementById('comment').style.display = 'inline'
          document.getElementById('comment' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('comment').style.display = 'none'
          document.getElementById('comment' + 'Label').style.display = 'none'
        }
        if (block.machiningDate != null) {
          document.getElementById('machiningDate').innerHTML = block.machiningDate
          document.getElementById('machiningDate').style.display = 'inline'
          document.getElementById('machiningDate' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('machiningDate').style.display = 'none'
          document.getElementById('machiningDate' + 'Label').style.display = 'none'
        }
        //tungsten table
        if (block.getTungstenData().some((value) => value != null)) {
          for (let i = 0; i < tungstenTableEntries.length; i++) {
            document.getElementById(tungstenTableEntries[i]).innerHTML = block.getTungstenData()[i]
          }
          document.getElementById('showTungstenTableBtn').style.display = 'block'
        } else {
          document.getElementById('showTungstenTableBtn').style.display = 'none'
          document.getElementById('tungstenTable').style.display = 'none'
        }
        //epoxy table
        if (block.getEpoxyData().some((value) => value != null)) {
          for (let i = 0; i < epoxyTableEntries.length; i++) {
            document.getElementById(epoxyTableEntries[i]).innerHTML = block.getEpoxyData()[i]
          }
          document.getElementById('showEpoxyTableBtn').style.display = 'block'
        } else {
          document.getElementById('showEpoxyTableBtn').style.display = 'none'
          document.getElementById('epoxyTable').style.display = 'none'
        }
        //pregrade
        if (block.pregrade != null) {
          document.getElementById('pregrade').innerHTML = block.pregrade
          let grade = grade_pregrade(block.pregrade)
          if (grade != null) {
            document.getElementById('pregrade').style.color = testColors[grade]
            document.getElementById('pregrade').style.fontWeight = 'bold'
          } else {
            document.getElementById('pregrade').style.color = black
            document.getElementById('pregrade').style.fontWeight = 'normal'
          }
          document.getElementById('pregrade').style.display = 'inline'
          document.getElementById('pregrade' + 'Label').style.display = 'inline'
        } else {
          document.getElementById('pregrade').style.display = 'none'
          document.getElementById('pregrade' + 'Label').style.display = 'none'
        }
        
        // DENSITY  (check if data is present)
        if (block.hasDensityData()) {
          // some block info present, so make the info section visible and update its entries and hide the noInfo section
          document.getElementById("densitySection").style.display = 'block'
          //density details
          if (block.volume != null) {
            document.getElementById('volume').innerHTML = block.volume + ' mL'
            document.getElementById('volume').style.display = 'inline'
            document.getElementById('volume' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('volume').style.display = 'none'
            document.getElementById('volume' + 'Label').style.display = 'none'
          }
          if (block.dimensionTester != null) {
            document.getElementById('dimensionTester').innerHTML = block.dimensionTester
            document.getElementById('dimensionTester').style.display = 'inline'
            document.getElementById('dimensionTester' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('dimensionTester').style.display = 'none'
            document.getElementById('dimensionTester' + 'Label').style.display = 'none'
          }
          if (block.mass != null) {
            document.getElementById('mass').innerHTML = block.mass + ' g'
            document.getElementById('mass').style.display = 'inline'
            document.getElementById('mass' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('mass').style.display = 'none'
            document.getElementById('mass' + 'Label').style.display = 'none'
          }
          if (block.massTester != null) {
            document.getElementById('massTester').innerHTML = block.massTester
            document.getElementById('massTester').style.display = 'inline'
            document.getElementById('massTester' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('massTester').style.display = 'none'
            document.getElementById('massTester' + 'Label').style.display = 'none'
          }
          if (block.density != null) {
            document.getElementById('density').innerHTML = block.density + ' g/mL'
            document.getElementById('density').style.color = testColors[grade_density(block.density)]
            document.getElementById('density').style.display = 'inline'
            document.getElementById('density' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('density').style.display = 'none'
            document.getElementById('density' + 'Label').style.display = 'none'
          }
          if (block.densityDate != null) {
            document.getElementById('densityDate').innerHTML = block.densityDate
            document.getElementById('densityDate').style.display = 'inline'
            document.getElementById('densityDate' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('densityDate').style.display = 'none'
            document.getElementById('densityDate' + 'Label').style.display = 'none'
          }
          //tolerances table
          if (block.deviations() != null) {
            const tolerancesTableEntries = ['L', 'BT', 'BB', 'BH', 'ST', 'SB', 'SH']
            for (let i = 0; i < tolerancesTableEntries.length; i++) {
              let deviation = block.deviations()[i]
              if (deviation <= 0) {
                document.getElementById(tolerancesTableEntries[i]).innerHTML = (deviation).toFixed(4)
              } else {
                document.getElementById(tolerancesTableEntries[i]).innerHTML = '+' + (deviation).toFixed(4)
              }
            }
            // color coding
            for (let i = 0; i < tolerancesTableEntries.length; i++) {
              document.getElementById(tolerancesTableEntries[i]).style.color = testColors[block.testGrades().tolerances[i]]
            }
            document.getElementById('densitySectionLabel').style.color = testColors[block.testGrades().density]
            document.getElementById('showTolerancesTableBtn').style.color = testColors[Math.max(...block.testGrades().tolerances)]
            document.getElementById('showTolerancesTableBtn').style.display = 'inline'
          } else {
            document.getElementById('showTolerancesTableBtn').style.display = 'none'
            document.getElementById('tolerancesTable').style.display = 'none'
          } 
        } else {
          // no block info present, so make the noInfo section visible and clear entries in info section
          document.getElementById("densityNoInfo").style.display = 'block'
        }

        // LIGHT TRANSMISSION (check if data is present)
        if (block.hasLightTransData()) {
          // some block info present, so make the info section visible and update its entries and hide the noInfo section
          document.getElementById("lightTransSection").style.display = 'block'
          if (block.goodEnd != null) {
            document.getElementById('goodEnd').innerHTML = block.goodEnd
            document.getElementById('goodEnd').style.display = 'inline'
            document.getElementById('goodEnd' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('goodEnd').style.display = 'none'
            document.getElementById('goodEnd' + 'Label').style.display = 'none'
          }
          if (block.fiberPercentage != null) {
            document.getElementById('fiberPercentage').innerHTML = parseFloat(block.fiberPercentage).toFixed(2) + ' %'
            document.getElementById('fiberPercentage').style.color = testColors[grade_fiberPercentage(block.fiberPercentage)]
            document.getElementById('fiberPercentage').style.display = 'inline'
            document.getElementById('fiberPercentage' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('fiberPercentage').style.display = 'none'
            document.getElementById('fiberPercentage' + 'Label').style.display = 'none'
          }
          if (block.missingRow != null) {
            let displayValue = (block.missingRow) ? 'Y' : 'N'
            document.getElementById('missingRow').innerHTML = displayValue
            document.getElementById('missingRow').style.color = testColors[grade_missingRow(block.missingRow)]
            document.getElementById('missingRow').style.display = 'inline'
            document.getElementById('missingRow' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('missingRow').style.display = 'none'
            document.getElementById('missingRow' + 'Label').style.display = 'none'
          }
          if (block.thirteenHoles != null) {
            let displayValue = (block.thirteenHoles) ? 'Y' : 'N'
            document.getElementById('thirteenHoles').innerHTML = displayValue
            document.getElementById('thirteenHoles').style.color = testColors[grade_thirteenHoles(block.thirteenHoles)]
            document.getElementById('thirteenHoles').style.display = 'inline'
            document.getElementById('thirteenHoles' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('thirteenHoles').style.display = 'none'
            document.getElementById('thirteenHoles' + 'Label').style.display = 'none'
          }
          if (block.lightTransTester != null) {
            document.getElementById('lightTransTester').innerHTML = block.lightTransTester
            document.getElementById('lightTransTester').style.display = 'inline'
            document.getElementById('lightTransTester' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('lightTransTester').style.display = 'none'
            document.getElementById('lightTransTester' + 'Label').style.display = 'none'
          }
          if (block.lightTransDate != null) {
            document.getElementById('lightTransDate').innerHTML = block.lightTransDate
            document.getElementById('lightTransDate').style.display = 'inline'
            document.getElementById('lightTransDate' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('lightTransDate').style.display = 'none'
            document.getElementById('lightTransDate' + 'Label').style.display = 'none'
          }
          const towerTableEntries = ['tower1', 'tower2', 'tower3', 'tower4']
          if (block.hasTowerData()) {
            let towers = [block.tower1, block.tower2, block.tower3, block.tower4]
            for (let i = 0; i < towerTableEntries.length; i++) {
              document.getElementById(towerTableEntries[i]).innerHTML = towers[i]
              document.getElementById(towerTableEntries[i]).style.color = testColors[grade_tower(towers[i])]

            }
            document.getElementById('showTowerTableBtn').style.display = 'inline'
          } else {
            document.getElementById('showTowerTableBtn').style.display = 'none'
            document.getElementById('towerTable').style.display = 'none'
          }
          // color coding
          document.getElementById('showTowerTableBtn').style.color = testColors[Math.max(...block.testGrades().towers)]
          document.getElementById('lightTransSectionLabel').style.color = testColors[block.testGrades().lightTrans]
          // and run getImageUrls
          document.getElementById("imagesSelection").style.display = 'block'
          document.getElementById("loadingImages").style.display = 'block'
          console.log('fetching image urls')
          if (slowMode) {
            getImageUrlsSlow(block.numericDBN)
          } else {
            block.getUrls(onGetImageUrlsSuccess, onGetHistogramsSuccess)
          }
          getImageUrlsRun = true
        } else {
          // no block info present, so make the noInfo section visible and clear entries in info section
          document.getElementById("lightTransNoInfo").style.display = 'block'
        }
        
        // NATURAL LIGHT (check if data is present)
        if (block.hasNatLightData()) {
          // some info present, so make the info section visible and update its entries and hide the noInfo section
          document.getElementById("natLightSection").style.display = 'block'
          if (block.natLightTester != null) {
            document.getElementById('natLightTester').innerHTML = block.natLightTester
            document.getElementById('natLightTester').style.display = 'inline'
            document.getElementById('natLightTester' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('natLightTester').style.display = 'none'
            document.getElementById('natLightTester' + 'Label').style.display = 'none'
          }
          if (block.natLightDate != null) {
            document.getElementById('natLightDate').innerHTML = block.natLightDate
            document.getElementById('natLightDate').style.display = 'inline'
            document.getElementById('natLightDate' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('natLightDate').style.display = 'none'
            document.getElementById('natLightDate' + 'Label').style.display = 'none'
          }
          // run getImageUrls if it hasn't been run by light transmission
          if (!getImageUrlsRun) {
            // run getImageUrls if it hasn't been run
            document.getElementById("imagesSelection").style.display = 'block'
            document.getElementById("loadingImages").style.display = 'block'
            console.log('fetching image urls')
            if (slowMode) {
              getImageUrlsSlow(block.numericDBN)
            } else {
              block.getUrls(onGetImageUrlsSuccess, onGetHistogramsSuccess)
            }
            getImageUrlsRun = true
          }
        } else {
          // no block info present, so make the noInfo section visible and clear entries in info section
          document.getElementById("natLightNoInfo").style.display = 'block'
          // I don't need to run getImageUrls, so if light transmission didn't run it, then we don't need any of the image checkboxes
          // AND we need to reset them (if they are checked, uncheck them and toggle)
          if (!getImageUrlsRun) {
            console.log('determined there was no need to search for images')
            resetCheckboxes()
          }
        }
        
        // SCINTILLATION (check if data is present)
        if (block.hasScintData()) {
          // some info present, so make the info section visible and update its entries and hide the noInfo section
          document.getElementById("scintSection").style.display = 'block'
          if (block.scintillation != null) {
            document.getElementById('scintillation').innerHTML = parseFloat(block.scintillation).toFixed(3) + ' mV'
            document.getElementById('scintillation').style.display = 'inline'
            document.getElementById('scintillation' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('scintillation').style.display = 'none'
            document.getElementById('scintillation' + 'Label').style.display = 'none'
          }
          if (block.scintRatio != null) {
            document.getElementById('scintRatio').innerHTML = block.scintRatio
            document.getElementById('scintRatio').style.color = testColors[grade_scintRatio(block.scintRatio)]
            document.getElementById('scintRatio').style.display = 'inline'
            document.getElementById('scintRatio' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('scintRatio').style.display = 'none'
            document.getElementById('scintRatio' + 'Label').style.display = 'none'
          }
          if (block.scintTester != null) {
            document.getElementById('scintTester').innerHTML = block.scintTester
            document.getElementById('scintTester').style.display = 'inline'
            document.getElementById('scintTester' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('scintTester').style.display = 'none'
            document.getElementById('scintTester' + 'Label').style.display = 'none'
          }
          if (block.scintDate != null) {
            document.getElementById('scintDate').innerHTML = block.scintDate
            document.getElementById('scintDate').style.display = 'inline'
            document.getElementById('scintDate' + 'Label').style.display = 'inline'
          } else {
            document.getElementById('scintDate').style.display = 'none'
            document.getElementById('scintDate' + 'Label').style.display = 'none'
          }
          document.getElementById('scintSectionLabel').style.color = testColors[grade_scintRatio(block.scintRatio)]
        } else {
          // no block info present, so make the noInfo section visible and clear entries in info section
          document.getElementById("scintNoInfo").style.display = 'block'
        }
        // now hide the loading block data text...
        document.getElementById("loadingBlockData").style.display = 'none'
      }
      // resets a checkbox to unchecked
      function resetCheckbox (imagePrefix) {
        // if a checkbox is checked, uncheck it and call it's toggle function to hide images
        if (document.getElementById('CBshow-' + imagePrefix).checked == true) {
          document.getElementById('CBshow-' + imagePrefix).checked = false
          toggleImages(imagePrefix)
        }
        // then hide the checkbox
        document.getElementById('CBshow-' + imagePrefix + 'Section').style.display = 'none'
      }
      // reset all checkboxes individually and hide checkboxes section
      function resetCheckboxes () {
        for (let i = 0; i < allImagePrefixes.length; i++) {
          resetCheckbox(allImagePrefixes[i])
        }
        document.getElementById("allCheckboxes").style.display = 'none'
      }

      // does not perfectly nicely handle the situation where ONE end's image is present and the other is not..
      // since this case is so rare, it tries to load both (and if one happens to not have an image, a placeholder is displayed)
      function onGetImageUrlsSuccess (imageUrls) {
        // check if getImageUrls returned any urls...
        if (imageUrls == null || imageUrls.every((element) => element == null)) {
          // ...NO image urls were returned, so there's no image data to display
          document.getElementById("loadingImages").style.display = 'none'
          document.getElementById("noImagesFound").style.display = 'block'
        } else {
          // first set all not null urls to their image srcs
          imageUrls.forEach((element, index) => {
            if (element != null) {
              if (index < 4) {
                document.getElementById(allTestingImgs[index]).src = element
              } else {
                document.getElementById(allTestingImgs[index]).src = element[0]
                let imageUrlsIndexToEnd = new Map([[4, 'Wide End'], [5, 'Narrow End']])
                let positionCodeToPosition = new Map([[1, '(pictured on left)'], [2, '(pictured on right)']])
                if (imageUrls[index][1] !== 0) {
                  document.getElementById('natLightImgFigCaption' + index).innerHTML = imageUrlsIndexToEnd.get(index) + ' ' + positionCodeToPosition.get(imageUrls[index][1])
                } else {
                  document.getElementById('natLightImgFigCaption' + index). innerHTML = imageUrlsIndexToEnd.get(index)
                }
              }
            }
          });
          // determine which checkboxes / image sections need to be displayed
          for (let i = 0; i < allImagePrefixes.length; i++) {
            if (imageUrls[2*i] != null || imageUrls[2*i + 1] != null) {
              // one of this section's images is present, so display its checkbox
              document.getElementById('CBshow-' + allImagePrefixes[i] + 'Section').style.display = 'block'
            } else {
              // this section is not needed—reset its checkbox
              resetCheckbox(allImagePrefixes[i])
            }
          }
          // finally, display the checkboxes section
          document.getElementById("loadingImages").style.display = 'none'
          document.getElementById("allCheckboxes").style.display = 'block'
        }
      }
      function onGetHistogramsSuccess (histogramUrls) {
        if (histogramUrls != null) {
          if (histogramUrls[0] != null) {
            document.getElementById('histogramWide').href = histogramUrls[0]
            document.getElementById('histogramWide').style.display = 'block'
          } else {
            document.getElementById('histogramWide').style.display = 'none'
          }
          if (histogramUrls[1] != null) {
            document.getElementById('histogramNarrow').href = histogramUrls[1]
            document.getElementById('histogramNarrow').style.display = 'block'
          } else {
            document.getElementById('histogramNarrow').style.display = 'none'
          }
        } else {
          document.getElementById('histogramWide').style.display = 'none'
          document.getElementById('histogramNarrow').style.display = 'none'
        }
      }

      function getImageUrlsSlow (dbn) {
        // check if getImageUrls returned any urls...
        if (bigArray[dbn] == null) {
          console.log('bigArray was null at index: ' + dbn)
          document.getElementById("loadingImages").style.display = 'none'
          document.getElementById("noImagesFound").style.display = 'block'
        } else {
          imageUrls = bigArray[dbn]
          if (imageUrls.every((element) => element == null)) {
            // ...NO image urls were returned, so there's no image data to display
            document.getElementById("loadingImages").style.display = 'none'
            document.getElementById("noImagesFound").style.display = 'block'
            return
          }
          // first set all not null urls to their image srcs
          imageUrls.forEach((element, index) => {
            if (element != null) {
              document.getElementById(allTestingImgs[index]).src = element[0]
            }
          });
          // determine which checkboxes / image sections need to be displayed
          for (let i = 0; i < allImagePrefixes.length; i++) {
            if (imageUrls[2*i] != null || imageUrls[2*i + 1] != null) {
              // one of this section's images is present, so display its checkbox
              document.getElementById('CBshow-' + allImagePrefixes[i] + 'Section').style.display = 'block'
            } else {
              // this section is not needed—reset its checkbox
              resetCheckbox(allImagePrefixes[i])
            }
          }
          // add suffixes to figure captions on NL images (left or right) if needed
          let imageUrlsIndexToEnd = new Map([[4, 'Wide End'], [5, 'Narrow End']])
          let positionCodeToPosition = new Map([[1, '(pictured on left)'], [2, '(pictured on right)']])
          for (let i = 4; i < imageUrls.length; i++) {
            if (imageUrls[i] != null) {
              if (imageUrls[i][2] != 0) {
                document.getElementById('natLightImgFigCaption' + i).innerHTML = imageUrlsIndexToEnd.get(i) + ' ' + positionCodeToPosition.get(imageUrls[i][2])
              } else {
                document.getElementById('natLightImgFigCaption' + i). innerHTML = imageUrlsIndexToEnd.get(i)
              }
            }
          }
          // finally, display the checkboxes section
          document.getElementById("loadingImages").style.display = 'none'
          document.getElementById("allCheckboxes").style.display = 'block'
        }
      }

      // takes an image name prefix (e.g. lightTransImg, lightTransImgCropped, or natLightImg)
      // and toggles the visibility of the corresponding wide and narrow images
      function toggleImages(imagePrefix) {
        let fig1 = document.getElementById(imagePrefix + 'FigW')
        let fig2 = document.getElementById(imagePrefix + 'FigN')
        if (fig1.style.display === "none" || fig2.style.display === "none") {
          fig1.style.display = "block"
          fig2.style.display = "block"
        } else {
          fig1.style.display = "none"
          fig2.style.display = "none"
        }
      }
      // changes the way image urls are obtained
      function madness () {
        alert('loading ALL image urls, do not submit another dbn before this request completes (should take about 90 seconds)')
        slowMode = true
        google.script.run.withSuccessHandler(onSuccess).loadBigArray()
        function onSuccess (data) {
          if (data == null) {
            console.log('bigArray was null :(')
            alert('there was an error fetching ALL image urls')
          } else {
            bigArray = data
            console.log('loaded bigArray')
            alert('loaded ALL image urls')
          }
        }
      }
      // hides/shows the tungsten table
      function toggleTungstenTable () {
        if (document.getElementById('tungstenTable').style.display === 'none') {
          document.getElementById('tungstenTable').style.display = 'block'
          document.getElementById('showTungstenTableBtn').innerHTML = 'Hide Tungsten Powder Infomation'
        } else {
          document.getElementById('tungstenTable').style.display = 'none'
          document.getElementById('showTungstenTableBtn').innerHTML = 'Show Tungsten Powder Information'
        }
      }
      // hides/shows the epoxy table
      function toggleEpoxyTable () {
        if (document.getElementById('epoxyTable').style.display === 'none') {
          document.getElementById('epoxyTable').style.display = 'block'
          document.getElementById('showEpoxyTableBtn').innerHTML = 'Hide Epoxy Information'
        } else {
          document.getElementById('epoxyTable').style.display = 'none'
          document.getElementById('showEpoxyTableBtn').innerHTML = 'Show Epoxy Information'
        }
      }
      // hides/shows the tolerances table
      function toggleTolerancesTable () {
        if (document.getElementById('tolerancesTable').style.display === 'none') {
          document.getElementById('tolerancesTable').style.display = 'block'
          document.getElementById('showTolerancesTableBtn').innerHTML = 'Hide Tolerances'
        } else {
          document.getElementById('tolerancesTable').style.display = 'none'
          document.getElementById('showTolerancesTableBtn').innerHTML = 'Show Tolerances'
        }
      }
      // hides/shows the tower table
      function toggleTowerTable () {
        if (document.getElementById('towerTable').style.display === 'none') {
          document.getElementById('towerTable').style.display = 'block'
          document.getElementById('showTowerTableBtn').innerHTML = 'Hide Tower Information'
        } else {
          document.getElementById('towerTable').style.display = 'none'
          document.getElementById('showTowerTableBtn').innerHTML = 'Show Tower Information'
        }
      }
      var filterDBNsValueArray
      var filterShipmentValueArray
      var filterStatusValueArray
      var filterBlockValueArray
      function filter () {
        function separate (inputString) {
          let string = inputString.slice()
          if (string == null || string === '') {
            return null
          } else {
            let array = string.split(',')
            array.forEach((value, index, array) => array[index] = value.trim())
            array = array.join(' ').split(' ')
            array.forEach((value, index, array) => array[index] = value.trim())
            return array
          }
        }
        filterDBNsValueArray = separate(document.getElementById('inputDBNs').value)
        filterShipmentValueArray = separate(document.getElementById('inputShipment').value)
        filterStatusValueArray = separate(document.getElementById('inputStatus').value)
        filterBlockValueArray = separate(document.getElementById('inputBlock').value)
        loadBlocksTable()
      }
      function clearInputShipment () {
        document.getElementById('inputShipment').value = null
        filter()
      }
      function clearInputStatus () {
        document.getElementById('inputStatus').value = null
        filter()
      }
      function clearInputBlock () {
        document.getElementById('inputBlock').value = null
        filter()
      }
      function clearInputDBNs () {
        document.getElementById('inputDBNs').value = null
        filter()
      }
      const tolerancesNames = ['dL', 'dBT', 'dBB', 'dBH', 'dST', 'dSB', 'dSH']
      const towerNames = ['tower1', 'tower2', 'tower3', 'tower4']
      function loadBlocksTable () {
        let dataTable = $('#blocksTable').DataTable()
        dataTable.clear()
        let tableColumnsNames = []
        let cols = dataTable.settings().init().columns
        for (let i = 0; i < cols.length; i++) {
          tableColumnsNames[dataTable.column(cols[i].name + ':name').index()] = cols[i].name
        }
        for (let i = 0; i < blocksCollection.array.length; i++) {
          let block = blocksCollection.array[i]
          let rowPassesFilter = block != null
            && (filterDBNsValueArray == null || filterDBNsValueArray.includes(block['dbn']))
            && (filterShipmentValueArray == null || filterShipmentValueArray.includes(block['shipment']))
            && (filterStatusValueArray == null || filterStatusValueArray.includes(block['status']))
            && (filterBlockValueArray == null || filterBlockValueArray.includes(block['block']))
          let sortColumns = arrayFromFirstElements(dataTable.order())
          if (rowPassesFilter) {
            let rowData = new Array(tableColumnsNames.length)
            let tolerances = block.deviations()
            for (let j = 0; j < tableColumnsNames.length; j++) {
              let name = tableColumnsNames[j]
              let data
              if (block.hasOwnProperty(name)) {
                data = block[tableColumnsNames[j]]
              }
              if (tolerancesNames.includes(name)) {
                let k = tolerancesNames.findIndex((value) => name === value)
                rowData[j] = (tolerances == null || tolerances[k] == null) ? '' : tolerances[k].toFixed(3)
              } else if (towerNames.includes(name)) {
                if (dataPresent(data)) {
                  rowData[j] = parseFloat(data).toFixed(2)
                } else {
                  rowData[j] = ''
                }
              } else if (name == 'pregrade') {
                if (block.pregrade != null) {
                  rowData[j] = data
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'toleranceMse') {
                if (tolerances != null && tolerances.every((value) => value != null)) {
                  tolerances.forEach((value, index, array) => array[index] = value * value)
                  rowData[j] = ((tolerances.reduce((a, b) => (a + b))) / 7).toFixed(9)
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'tungstenMass') {
                if (data !== '0') {
                  rowData[j] = data
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'fiberPercentage') {
                if (dataPresent(data) && data !== '0.00') {
                  rowData[j] =  parseFloat(data).toFixed(2)
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'scintillation') {
                if (dataPresent(data)) {
                  rowData[j] = parseFloat(data).toFixed(3)
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'volume') {
                if (dataPresent(data) && data !== '0.0') {
                  rowData[j] = parseFloat(data).toFixed(3)
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'testingStatus') {
                let grades = block.testGrades()
                if (grades != null) { 
                  data = []
                  data[0] = [grades.density, block.densityChecked, block.densityComplete]
                  data[1] = [grades.lightTrans, block.lightTransChecked, block.lightTransComplete]
                  data[2] = [grades.scint]
                  data[3] = [grades.natLight, block.natLightChecked, block.natLightComplete]
                  rowData[j] = data
                } else {
                  rowData[j] = ''
                }
              } else if (name === 'readyToGrade') {
                if (block != null) {
                  if (block.testsComplete && block.testsChecked) {
                    rowData[j] = {text: 'Ready', color: green}
                  } else if (block.testsComplete) {
                    rowData[j] = {text: 'Needs Checks', color: orange}
                  } else {
                    rowData[j] = {text: 'Needs Tests', color: grey}
                  }
                } else {
                  rowData[j] = {text: '', color: black}
                }
              } else if (name === 'missingRow' || name === 'thirteenHoles') {
                rowData[j] = data
              } else {
                if (dataPresent(data)) {
                  rowData[j] = data
                } else {
                  rowData[j] = ''
                }
              }
            }
            if (!hideUninterestingRows || sortColumns.every((value) => rowData[value] !== '')) {
              dataTable.row.add(rowData)
            }
          }
        }
        dataTable.columns.adjust().draw()
      }
      function loadRetouchTables() {
        if (blocksCollection == null) {
          return
        }
        let candidateDataTable = $('#candidateRetouchTable').DataTable()
        let sentDataTable = $('#sentRetouchTable').DataTable()
        blocksCollection.getBlocksNeedingRetouch('').forEach(function(data) {
          let rowData = []
          rowData[0] = data[0].dbn
          rowData[1] = data[0].status
          rowData[2] = data[0].retouch
          rowData[3] = data[1]
          candidateDataTable.row.add(rowData)
        })
        blocksCollection.getBlocksNeedingRetouch('R').forEach(function(data) {
          let rowData = []
          rowData[0] = data[0].dbn
          rowData[1] = data[0].status
          rowData[2] = data[0].retouch
          rowData[3] = data[1]
          candidateDataTable.row.add(rowData)
        })
        blocksCollection.getBlocksNeedingRetouch('S').forEach(function(data) {
          let rowData = []
          rowData[0] = data[0].dbn
          rowData[1] = data[0].status
          rowData[2] = data[1]
          sentDataTable.row.add(rowData)
        })
        candidateDataTable.columns.adjust().draw()
        sentDataTable.columns.adjust().draw()
        document.getElementById('candidateRetouchCount').innerHTML = candidateDataTable.rows().count()
        document.getElementById('sentRetouchCount').innerHTML = sentDataTable.rows().count()
      }
      function calcDateRange() {
        let fromInput = document.getElementById('fromDate').value
        let toInput = document.getElementById('toDate').value
        if (((isNaN(fromInput) || fromInput.length !== 8) && fromInput !== '') || ((isNaN(toInput) || toInput.length !== 8) && toInput !== '')) {
          alert('please enter dates in YYYYMMDD format or leave input dates blank')
          return
        }
        function elementsToDBN (array) {
          array.forEach((value, index, array) => array[index] = value.dbn)
        }
        let from = (fromInput === '') ? null : parseInt(fromInput)
        let to = (toInput === '') ? null : parseInt(toInput)
        let dateRangeBlocks = blocksCollection.getBlocksModifiedInDateRange(from, to)
        elementsToDBN(dateRangeBlocks.tungstenFilled)
        elementsToDBN(dateRangeBlocks.epoxyFilled)
        elementsToDBN(dateRangeBlocks.machined)
        elementsToDBN(dateRangeBlocks.densityTested)
        elementsToDBN(dateRangeBlocks.lightTransTested)
        elementsToDBN(dateRangeBlocks.scintTested)
        elementsToDBN(dateRangeBlocks.natLightTested)
        document.getElementById('tungstenFilledDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.tungstenFilled)
        document.getElementById('tungstenFilledDateRangeCount').innerHTML = dateRangeBlocks.tungstenFilled.length
        document.getElementById('epoxyFilledDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.epoxyFilled)
        document.getElementById('epoxyFilledDateRangeCount').innerHTML = dateRangeBlocks.epoxyFilled.length
        document.getElementById('machinedDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.machined)
        document.getElementById('machinedDateRangeCount').innerHTML = dateRangeBlocks.machined.length
        document.getElementById('densityTestedDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.densityTested)
        document.getElementById('densityTestedDateRangeCount').innerHTML = dateRangeBlocks.densityTested.length
        document.getElementById('lightTransTestedDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.lightTransTested)
        document.getElementById('lightTransTestedDateRangeCount').innerHTML = dateRangeBlocks.lightTransTested.length
        document.getElementById('scintTestedDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.scintTested)
        document.getElementById('scintTestedDateRangeCount').innerHTML = dateRangeBlocks.scintTested.length
        document.getElementById('natLightTestedDateBlocks').innerHTML = arrayToStringList(dateRangeBlocks.natLightTested)
        document.getElementById('natLightTestedDateRangeCount').innerHTML = dateRangeBlocks.natLightTested.length
      }
      function findBlocksFromList (stringList) {
        document.getElementById('inputDBNs').value = stringList
        document.getElementById('inputShipment').value = ''
        document.getElementById('inputStatus').value = ''
        document.getElementById('inputBlock').value = ''
        loadFindBlocks()
        filter()
      }
      function calcLastDays() {
        let days = parseInt(document.getElementById('lastDays').value)
        if (!isNaN(days) && days >= 0) {
          let from = new Date(currentDate)
          for (let i = 0; i < days; i++) {
            from.setDate(from.getDate() - 1)
            if (from.getDay() === 0 || from.getDay() === 6) {
              i--
            }
          }
          document.getElementById('fromDate').value = dateToYYYYMMDD(from)
          document.getElementById('toDate').value = dateToYYYYMMDD(currentDate)
          calcDateRange()
        } else {
          alert('invalid last _ days input')
        }
      }
      function calcThisWeek() {
        let from = new Date(currentDate)
        while (from.getDay() !== 0) {
          from.setDate(from.getDate() - 1)
        }
        currentWeekBeginDate = from
        let to = new Date(from)
        to.setDate(to.getDate() + 6)
        document.getElementById('fromDate').value = dateToYYYYMMDD(from)
        document.getElementById('toDate').value = dateToYYYYMMDD(to)
        calcDateRange()
      }
      var currentWeekBeginDate
      function changeWeek(index) {
        currentWeekBeginDate.setDate(currentWeekBeginDate.getDate() + 7 * index)
        let temp = new Date(currentWeekBeginDate)
        temp.setDate(temp.getDate() + 6)
        document.getElementById('fromDate').value = dateToYYYYMMDD(currentWeekBeginDate)
        document.getElementById('toDate').value = dateToYYYYMMDD(temp)
        calcDateRange()
      }
      function loadFindBlockInfo () {
        document.getElementById('findBlockInfo').style.display = 'block'
        document.getElementById('findBlocks').style.display = 'none'
        document.getElementById('findRetouch').style.display = 'none'
        document.getElementById('dateRange').style.display = 'none'
      }
      function loadFindBlocks () {
        document.getElementById('findBlocks').style.display = 'block'
        document.getElementById('findBlockInfo').style.display = 'none'
        document.getElementById('dateRange').style.display = 'none'
      }
      var loadedRetouch = false
      function loadRetouch() {
        document.getElementById('findRetouch').style.display = 'block'
        document.getElementById('findBlockInfo').style.display = 'none'
        if (!loadedRetouch) {
          loadRetouchTables()
          loadedRetouch = true
        }
      }
      function loadDateRange () {
        document.getElementById('dateRange').style.display = 'block'
        document.getElementById('findBlockInfo').style.display = 'none'
      }
      var hideUninterestingRows = true
      function toggleShowRows () {
        hideUninterestingRows = !hideUninterestingRows
        filter()
      }
			</script>
</body>

</html>